<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="utf-8">
  

  
  <title>Study Notes</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="some notes for web front end">
<meta name="keywords" content="web front end study">
<meta property="og:type" content="website">
<meta property="og:title" content="Study Notes">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="Study Notes">
<meta property="og:description" content="some notes for web front end">
<meta property="og:locale" content="zh-cn">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Study Notes">
<meta name="twitter:description" content="some notes for web front end">
  
    <link rel="alternate" href="/atom.xml" title="Study Notes" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
</head>
</html>
<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Study Notes</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">web front end</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://yoursite.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-post06 cookie和session" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/04/16/post06 cookie和session/" class="article-date">
  <time datetime="2019-04-16T12:48:05.854Z" itemprop="datePublished">2019-04-16</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="1-cookie介绍"><a href="#1-cookie介绍" class="headerlink" title="1. cookie介绍"></a>1. cookie介绍</h2><h3 id="1-1-什么是cookie，作用是什么"><a href="#1-1-什么是cookie，作用是什么" class="headerlink" title="1.1 什么是cookie，作用是什么"></a>1.1 什么是cookie，作用是什么</h3><ul>
<li>由于<strong>Http协议是无状态</strong>的，且传统服务器<strong>只能被动的响应请求</strong>，所以，当服务器获取到请求的时候，并不知道当前请求属于哪个客户端！</li>
<li>服务器为了能够明确区分每个客户端，需要使用一些小技术，来根据不同的请求区分不同的客户端；</li>
<li>只要有请求发生，那么必然对应一个客户端，我们可以在每次客户端发起请求的时候，向服务器自动发送一个标识符，告诉服务器当前是哪个客户端正在请求服务器的数据；</li>
<li>如何提供这个标识符呢？我们可以在请求头(Request Headers)中添加一个标签，叫做<code>cookie</code>，这样，每次发送请求，都会把这个cookie随同其他报文一起发送给服务器，服务器可以根据报文中的cookie，区分不同的客户端浏览器。</li>
<li><p>如何在客户端请求头中添加标识符？</p>
</li>
<li><p>在Node中可以在<code>writeHeader</code>的时候，通过<code>Set-Cookie</code>来将cookie标识通过响应报文发送给客户端！</p>
</li>
<li>客户端也可以通过一些方式来操作自己的cookie，比如通过<code>jquery.cookie</code>这个插件！</li>
</ul>
<h3 id="1-2-cookie的基本使用"><a href="#1-2-cookie的基本使用" class="headerlink" title="1.2 cookie的基本使用"></a>1.2 cookie的基本使用</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> http = <span class="built_in">require</span>(<span class="string">'http'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> server = http.createServer();</span><br><span class="line"></span><br><span class="line">server.on(<span class="string">'request'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 解析cookie</span></span><br><span class="line">    <span class="keyword">var</span> cookies = &#123;&#125;;</span><br><span class="line">    <span class="keyword">var</span> cookieStr = req.headers.cookie; <span class="comment">// 从请求的headers中获取cookie信息</span></span><br><span class="line">    cookieStr &amp;&amp; cookieStr.split(<span class="string">';'</span>).forEach(<span class="function"><span class="keyword">function</span> (<span class="params">item</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> parts = item.split(<span class="string">'='</span>);</span><br><span class="line">        cookies[parts[<span class="number">0</span>].trim()] = parts[<span class="number">1</span>].trim(); <span class="comment">// 将cookie解析出来，保存到对象中</span></span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    res.writeHeader(<span class="number">200</span>, &#123;</span><br><span class="line">        <span class="string">'Content-Type'</span>: <span class="string">'text/plain; charset=utf-8'</span>,</span><br><span class="line">        <span class="string">"Set-Cookie"</span>: [<span class="string">'issend=ok'</span>, <span class="string">'age=20'</span>]</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(cookies.issend ===<span class="string">'ok'</span>)&#123;</span><br><span class="line">        res.end(<span class="string">'不要太贪心哦！'</span>);</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        res.end(<span class="string">'呐，赏你一朵小红花~~'</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">server.listen(<span class="number">4000</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'服务器已启动!'</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h3 id="1-3-通过expires设置Cookie的过期时间"><a href="#1-3-通过expires设置Cookie的过期时间" class="headerlink" title="1.3 通过expires设置Cookie的过期时间"></a>1.3 通过<code>expires</code>设置Cookie的过期时间</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 设置 过期时间 为60秒之后</span></span><br><span class="line"><span class="comment">// 注意：在设置过期时间的时候，需要将时间转换为 UTC 格式</span></span><br><span class="line"><span class="comment">// Date.now() 获取总秒数,new Date()设置cookie保存的时间,toUTCString()转化固定格式时间字符串</span></span><br><span class="line"><span class="keyword">var</span> expiresTime = <span class="keyword">new</span> <span class="built_in">Date</span>(<span class="built_in">Date</span>.now() + <span class="number">1000</span> * <span class="number">60</span>).toUTCString();</span><br><span class="line">res.writeHeader(<span class="number">200</span>, &#123;</span><br><span class="line">  <span class="string">'Content-Type'</span>: <span class="string">'text/html; charset=utf-8'</span>,</span><br><span class="line">  <span class="string">'Set-Cookie'</span>: [<span class="string">'isvisit=true;expires='</span> + expiresTime, <span class="string">'test=OK'</span>]</span><br><span class="line">&#125;);</span><br><span class="line">res.end(<span class="string">'&lt;h3&gt;你好，欢迎光临，送给你一个苹果！&lt;/h3&gt;'</span>);</span><br></pre></td></tr></table></figure>
<h3 id="1-4-cookie可以被伪造，不安全"><a href="#1-4-cookie可以被伪造，不安全" class="headerlink" title="1.4 cookie可以被伪造，不安全"></a>1.4 cookie可以被伪造，不安全</h3><p>使用谷歌插件<code>edit this cookie</code>，就能伪造cookie数据！所以不要使用cookie存储敏感的数据！比如登录状态和登录信息；<br>一些敏感的数据，应该存储都服务器端！</p>
<h3 id="1-5-什么是Cookie的应用场景"><a href="#1-5-什么是Cookie的应用场景" class="headerlink" title="1.5 什么是Cookie的应用场景"></a>1.5 什么是Cookie的应用场景</h3><ol>
<li>对安全性要求不高</li>
<li>不需要存储大量的数据</li>
<li>主要应用场景，是用来做 客户端 与 服务器之间的 状态保持技术；</li>
</ol>
<h2 id="2-登录退出及状态保存"><a href="#2-登录退出及状态保存" class="headerlink" title="2. 登录退出及状态保存"></a>2. 登录退出及状态保存</h2><h3 id="2-1-使用express-session来保存登录状态"><a href="#2-1-使用express-session来保存登录状态" class="headerlink" title="2.1 使用express-session来保存登录状态"></a>2.1 使用<code>express-session</code>来保存登录状态</h3><h4 id="2-1-1-什么是session"><a href="#2-1-1-什么是session" class="headerlink" title="2.1.1 什么是session"></a>2.1.1 什么是session</h4><p>由于HTTP是无状态的，所以服务器在每次连接中持续保存客户端的私有数据，此时需要结合cookie技术，通过session会话机制，在服务器端保存每个HTTP请求的私有数据；</p>
<h4 id="2-1-2-session原理"><a href="#2-1-2-session原理" class="headerlink" title="2.1.2 session原理"></a>2.1.2 session原理</h4><p>在服务器内存中开辟一块地址空间，专门存放每个客户端私有的数据，每个客户端根据cookie中保存的私有sessionId，可以获取到独属于自己的session数据。</p>
<h4 id="2-1-3-在express中使用session"><a href="#2-1-3-在express中使用session" class="headerlink" title="2.1.3 在express中使用session"></a>2.1.3 在express中使用session</h4><p>1.安装session模块</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install express-session -S</span><br></pre></td></tr></table></figure>
<p>2.导入session模块</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> session = <span class="built_in">require</span>(<span class="string">'express-session'</span>)</span><br></pre></td></tr></table></figure>
<p>3.在express中使用<code>session</code>中间件：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 启用 session 中间件</span></span><br><span class="line">app.use(session(&#123;</span><br><span class="line">  secret: <span class="string">'keyboard cat'</span>, <span class="comment">// 相当于是一个加密密钥，值可以是任意字符串</span></span><br><span class="line">  resave: <span class="literal">false</span>, <span class="comment">// 强制session保存到session store中</span></span><br><span class="line">  saveUninitialized: <span class="literal">false</span> <span class="comment">// 强制没有“初始化”的session保存到storage中</span></span><br><span class="line">&#125;))</span><br></pre></td></tr></table></figure>
<p>4.将私有数据保存到当前请求的session会话中：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 将登录的用户保存到session中</span></span><br><span class="line">req.session.user = result.dataValues;</span><br><span class="line"><span class="comment">// 设置是否登录为true</span></span><br><span class="line">req.session.islogin = <span class="literal">true</span>;</span><br></pre></td></tr></table></figure>
<p>5.通过<code>destroy()</code>方法清空<code>session</code>数据：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">req.session.destroy(<span class="function"><span class="keyword">function</span>(<span class="params">err</span>)</span>&#123;</span><br><span class="line">  <span class="keyword">if</span>(err) <span class="keyword">throw</span> err;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'用户退出成功！'</span>);</span><br><span class="line">  <span class="comment">// 实现服务器端的跳转，这个对比于 客户端跳转</span></span><br><span class="line">  res.redirect(<span class="string">'/'</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/04/16/post06 cookie和session/" data-id="cjujtsswq00025st3vmnyl6uy" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-post05" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/04/16/post05/" class="article-date">
  <time datetime="2019-04-16T11:18:02.811Z" itemprop="datePublished">2019-04-16</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/04/16/post05/">node.js study day07 博客案例整理</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><a href="#1">1.准备工作</a></p>
<p><a href="#2">2.入口文件—&gt;app.js</a></p>
<p><a href="#3">3.页面文件—&gt;views</a></p>
<p><a href="#4">4.注册功能的实现—&gt;register</a></p>
<p><a href="#5">5.登录功能的实现—&gt;login</a></p>
<p><a href="#6">6.按功能抽离模块—&gt;/router和/controller</a></p>
<p><a href="#7">7.注销功能的实现—&gt;logout</a></p>
<h2 id="node-js-study-day07-博客案例整理"><a href="#node-js-study-day07-博客案例整理" class="headerlink" title="node.js study day07 博客案例整理"></a>node.js study day07 博客案例整理</h2><h3 id="1-准备工作"><a href="#1-准备工作" class="headerlink" title="1.准备工作"></a>1.准备工作<a name="1"></a></h3><h4 id="1-1-创建文件"><a href="#1-1-创建文件" class="headerlink" title="1.1 创建文件"></a>1.1 创建文件</h4><p>创建mypro文件,开启phpstudy中的mysql,在expressStudy数据库中创建bloguser表</p>
<h4 id="1-2-mypro文件初始化"><a href="#1-2-mypro文件初始化" class="headerlink" title="1.2 mypro文件初始化"></a>1.2 mypro文件初始化</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">yarn init -y</span><br><span class="line">yarn add body-parser</span><br><span class="line">yarn add bootstrap</span><br><span class="line">yarn add ejs</span><br><span class="line">yarn add express</span><br><span class="line">yarn add express-session</span><br><span class="line">yarn add jquery</span><br><span class="line">yarn add moment</span><br><span class="line">yarn add mysql</span><br></pre></td></tr></table></figure>
<p>注意:在实现相应功能时,需要相关的模块再下载</p>
<h4 id="1-3-bloguser表格"><a href="#1-3-bloguser表格" class="headerlink" title="1.3 bloguser表格"></a>1.3 bloguser表格</h4><p>字段: id(key 自增)   username  password  nickname  ctime  isdel(默认0,0未删除,1已删除)</p>
<h3 id="2-入口文件—-gt-app-js"><a href="#2-入口文件—-gt-app-js" class="headerlink" title="2.入口文件—&gt;app.js"></a>2.入口文件—&gt;app.js<a name="2"></a></h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> express=<span class="built_in">require</span>(<span class="string">'express'</span>);</span><br><span class="line"><span class="keyword">const</span> app=express();</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> bodyParser=<span class="built_in">require</span>(<span class="string">'body-parser'</span>);</span><br><span class="line">app.use(bodyParser.urlencoded(&#123;<span class="attr">extended</span>:<span class="literal">false</span>&#125;));</span><br><span class="line"></span><br><span class="line">app.use(<span class="string">'/node_modules'</span>,express.static(<span class="string">'./node_modules'</span>));<span class="comment">//静态资源引用路径一致</span></span><br><span class="line"></span><br><span class="line">app.set(<span class="string">'view engine'</span>,<span class="string">'ejs'</span>);</span><br><span class="line">app.set(<span class="string">'views'</span>,<span class="string">'./views'</span>);</span><br><span class="line"></span><br><span class="line">app.get(<span class="string">'/'</span>,(req,res)=&gt;&#123;</span><br><span class="line">    res.render(<span class="string">'index.ejs'</span>,&#123;&#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">app.get(<span class="string">'/register'</span>, res.render(<span class="string">'./user/register.ejs'</span>,&#123;&#125;);</span><br><span class="line">app.get(<span class="string">'/login'</span>, res.render(<span class="string">'./user/login.ejs'</span>,&#123;&#125;);</span><br><span class="line"></span><br><span class="line">app.listen(<span class="number">80</span>, () =&gt; <span class="built_in">console</span>.log(<span class="string">'server running at http://127.0.0.1'</span>));<span class="comment">//默认端口为80,不用加端口号</span></span><br></pre></td></tr></table></figure>
<h3 id="3-页面文件—-gt-views"><a href="#3-页面文件—-gt-views" class="headerlink" title="3.页面文件—&gt;views"></a>3.页面文件—&gt;views<a name="3"></a></h3><h4 id="3-1-views-index-ejs"><a href="#3-1-views-index-ejs" class="headerlink" title="3.1 /views/index.ejs"></a>3.1 /views/index.ejs</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span> <span class="attr">content</span>=<span class="string">"width=device-width, initial-scale=1.0"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"X-UA-Compatible"</span> <span class="attr">content</span>=<span class="string">"ie=edge"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>博客<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">href</span>=<span class="string">"../node_modules/bootstrap/dist/css/bootstrap.min.css"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"../node_modules/jquery/dist/jquery.min.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"../node_modules/bootstrap/dist/js/bootstrap.min.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">nav</span> <span class="attr">class</span>=<span class="string">"navbar navbar-default"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"container-fluid"</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- Brand and toggle get grouped for better mobile display --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"navbar-header"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">class</span>=<span class="string">"navbar-toggle collapsed"</span> <span class="attr">data-toggle</span>=<span class="string">"collapse"</span></span></span><br><span class="line"><span class="tag">                    <span class="attr">data-target</span>=<span class="string">"#bs-example-navbar-collapse-1"</span> <span class="attr">aria-expanded</span>=<span class="string">"false"</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"sr-only"</span>&gt;</span>Toggle navigation<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"icon-bar"</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"icon-bar"</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"icon-bar"</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">"navbar-brand"</span> <span class="attr">href</span>=<span class="string">"#"</span>&gt;</span>博客<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"collapse navbar-collapse"</span> <span class="attr">id</span>=<span class="string">"bs-example-navbar-collapse-1"</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!-- 用户名注销 --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"nav navbar-nav navbar-right navbar-form"</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">"btn btn-warning"</span>&gt;</span>你好<span class="tag">&lt;<span class="name">strong</span>&gt;</span><span class="tag">&lt;/<span class="name">strong</span>&gt;</span><span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">"btn btn-danger"</span> <span class="attr">href</span>=<span class="string">"/logout"</span>&gt;</span>注销<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">ul</span> <span class="attr">class</span>=<span class="string">"nav navbar-nav navbar-right"</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"dropdown"</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"#"</span> <span class="attr">class</span>=<span class="string">"dropdown-toggle"</span> <span class="attr">data-toggle</span>=<span class="string">"dropdown"</span> <span class="attr">role</span>=<span class="string">"button"</span> <span class="attr">aria-haspopup</span>=<span class="string">"true"</span></span></span><br><span class="line"><span class="tag">                            <span class="attr">aria-expanded</span>=<span class="string">"false"</span>&gt;</span>发表 <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"caret"</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">ul</span> <span class="attr">class</span>=<span class="string">"dropdown-menu"</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"#"</span>&gt;</span>文章<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">li</span> <span class="attr">role</span>=<span class="string">"separator"</span> <span class="attr">class</span>=<span class="string">"divider"</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"#"</span>&gt;</span>问题<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!-- 登录注册 --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"nav navbar-nav navbar-right navbar-form"</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">"btn btn-success"</span> <span class="attr">href</span>=<span class="string">"/login"</span>&gt;</span>登录<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">"btn btn-primary"</span> <span class="attr">href</span>=<span class="string">"/register"</span>&gt;</span>注册<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">nav</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>文章列表<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"text-center text-muted"</span>&gt;</span></span><br><span class="line">        程序员 &amp;copy; 武汉2018</span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="3-2-views-user-register-ejs"><a href="#3-2-views-user-register-ejs" class="headerlink" title="3.2 /views/user/register.ejs"></a>3.2 /views/user/register.ejs</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span> <span class="attr">content</span>=<span class="string">"width=device-width, initial-scale=1.0"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"X-UA-Compatible"</span> <span class="attr">content</span>=<span class="string">"ie=edge"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">type</span>=<span class="string">"text/css"</span> <span class="attr">href</span>=<span class="string">"/node_modules/bootstrap/dist/css/bootstrap.min.css"</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="undefined">    #form &#123;</span></span><br><span class="line"><span class="undefined">      width: 400px;</span></span><br><span class="line"><span class="undefined">      margin: 0 auto;</span></span><br><span class="line"><span class="undefined">      margin-top: 100px;</span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="undefined">    h1 &#123;</span></span><br><span class="line"><span class="undefined">      text-align: center;</span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="undefined">    input[type='submit'] &#123;</span></span><br><span class="line"><span class="undefined">      width: 100%;</span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="undefined">  </span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">form</span> <span class="attr">id</span>=<span class="string">"form"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>注册页面<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"form-group"</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- required属性要求该项必填 --&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"username"</span> <span class="attr">id</span>=<span class="string">"username"</span> <span class="attr">class</span>=<span class="string">"form-control input-lg"</span> <span class="attr">placeholder</span>=<span class="string">"用户名"</span> <span class="attr">required</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"form-group"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"password"</span> <span class="attr">name</span>=<span class="string">"password"</span> <span class="attr">id</span>=<span class="string">"password"</span> <span class="attr">class</span>=<span class="string">"form-control input-lg"</span> <span class="attr">placeholder</span>=<span class="string">"密码"</span> <span class="attr">required</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"form-group"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"nickname"</span> <span class="attr">id</span>=<span class="string">"nickname"</span> <span class="attr">class</span>=<span class="string">"form-control input-lg"</span> <span class="attr">placeholder</span>=<span class="string">"昵称"</span> <span class="attr">required</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"form-group"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">value</span>=<span class="string">"注册新用户"</span> <span class="attr">class</span>=<span class="string">"btn btn-primary btn-lg"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="3-3-views-user-login-ejs"><a href="#3-3-views-user-login-ejs" class="headerlink" title="3.3 /views/user/login.ejs"></a>3.3 /views/user/login.ejs</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span> <span class="attr">content</span>=<span class="string">"width=device-width, initial-scale=1.0"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"X-UA-Compatible"</span> <span class="attr">content</span>=<span class="string">"ie=edge"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">type</span>=<span class="string">"text/css"</span> <span class="attr">href</span>=<span class="string">"/node_modules/bootstrap/dist/css/bootstrap.min.css"</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="undefined">    #form &#123;</span></span><br><span class="line"><span class="undefined">      width: 400px;</span></span><br><span class="line"><span class="undefined">      margin: 0 auto;</span></span><br><span class="line"><span class="undefined">      margin-top: 100px;</span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="undefined">    h1 &#123;</span></span><br><span class="line"><span class="undefined">      text-align: center;</span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="undefined">    input[type='submit'] &#123;</span></span><br><span class="line"><span class="undefined">      width: 100%;</span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="undefined">  </span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">form</span> <span class="attr">id</span>=<span class="string">"form"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>登录页面<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"form-group"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"username"</span> <span class="attr">id</span>=<span class="string">"username"</span> <span class="attr">class</span>=<span class="string">"form-control input-lg"</span> <span class="attr">placeholder</span>=<span class="string">"请输入用户名"</span> <span class="attr">required</span></span></span><br><span class="line"><span class="tag">        <span class="attr">value</span>=<span class="string">""</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"form-group"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"password"</span> <span class="attr">name</span>=<span class="string">"password"</span> <span class="attr">id</span>=<span class="string">"password"</span> <span class="attr">class</span>=<span class="string">"form-control input-lg"</span> <span class="attr">placeholder</span>=<span class="string">"请输入密码"</span> <span class="attr">required</span></span></span><br><span class="line"><span class="tag">        <span class="attr">value</span>=<span class="string">""</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"form-group"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"/register"</span> <span class="attr">class</span>=<span class="string">"pull-right"</span>&gt;</span>去注册<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"form-group"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">value</span>=<span class="string">"登录"</span> <span class="attr">class</span>=<span class="string">"btn btn-primary btn-lg"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="4-注册功能的实现—-gt-register"><a href="#4-注册功能的实现—-gt-register" class="headerlink" title="4.注册功能的实现—&gt;register"></a>4.注册功能的实现—&gt;register<a name="4"></a></h3><h4 id="4-1-views-user-register-ejs"><a href="#4-1-views-user-register-ejs" class="headerlink" title="4.1  /views/user/register.ejs"></a>4.1  /views/user/register.ejs</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"/node_modules/jquery/dist/jquery.min.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript">    $(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">      $(<span class="string">'#form'</span>).on(<span class="string">'submit'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">e</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        $.ajax(&#123;</span></span><br><span class="line"><span class="javascript">          type: <span class="string">'post'</span>,</span></span><br><span class="line"><span class="javascript">          url: <span class="string">'/register'</span>,</span></span><br><span class="line"><span class="javascript">          data: $(<span class="keyword">this</span>).serialize(),<span class="comment">//jquery序列化获取表单value值,不推荐,应获取各value值后在beforeSend中完成初步验证,正则等</span></span></span><br><span class="line"><span class="javascript">          dataType: <span class="string">'json'</span>,</span></span><br><span class="line"><span class="javascript">          success: <span class="function"><span class="keyword">function</span> (<span class="params">res</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">            <span class="built_in">console</span>.log(res);</span></span><br><span class="line"><span class="javascript">            <span class="keyword">if</span> (res.status == <span class="number">200</span>) &#123;</span></span><br><span class="line"><span class="javascript">              location.href = <span class="string">'/login'</span>;</span></span><br><span class="line"><span class="undefined">            &#125;</span></span><br><span class="line"><span class="undefined">          &#125;</span></span><br><span class="line"><span class="undefined">        &#125;)</span></span><br><span class="line"><span class="javascript">        <span class="keyword">return</span> <span class="literal">false</span>;</span></span><br><span class="line"><span class="undefined">      &#125;)</span></span><br><span class="line"><span class="undefined">    &#125;)</span></span><br><span class="line"><span class="undefined">  </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="4-2-app-js"><a href="#4-2-app-js" class="headerlink" title="4.2 app.js"></a>4.2 app.js</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> moment = <span class="built_in">require</span>(<span class="string">'moment'</span>);<span class="comment">//第三方中间件生成固定格式时间</span></span><br><span class="line"><span class="keyword">const</span> mysql = <span class="built_in">require</span>(<span class="string">'mysql'</span>);</span><br><span class="line"><span class="keyword">const</span> conn = mysql.createConnection(&#123;</span><br><span class="line">    host: <span class="string">'127.0.0.1'</span>,</span><br><span class="line">    user: <span class="string">'root'</span>,</span><br><span class="line">    password: <span class="string">'root'</span>,</span><br><span class="line">    database: <span class="string">'expressStudy'</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">app.post(<span class="string">'/register'</span>,(req,res)=&gt;&#123;</span><br><span class="line">    <span class="keyword">let</span> data = req.body;</span><br><span class="line">    <span class="keyword">if</span> (data.username.trim().length == <span class="string">''</span> || data.password.trim().length == <span class="string">''</span> || data.nickname.trim().length == <span class="string">''</span>) <span class="keyword">return</span> res.send(&#123; <span class="attr">status</span>: <span class="number">501</span>, <span class="attr">msg</span>: <span class="string">'请输入完整的用户信息'</span> &#125;);<span class="comment">//基础验证应在客户端完成</span></span><br><span class="line">    <span class="keyword">const</span> sql1 = <span class="string">'select count(*) as count from blogUser where username=?'</span>;</span><br><span class="line">    conn.query(sql1, data.username, (err, result) =&gt; &#123;</span><br><span class="line">        <span class="keyword">if</span> (err) <span class="keyword">return</span> res.send(&#123; <span class="attr">status</span>: <span class="number">502</span>, <span class="attr">msg</span>: <span class="string">'查询用户名失败'</span> &#125;);</span><br><span class="line">        <span class="keyword">if</span> (result[<span class="number">0</span>].count == <span class="number">1</span>) <span class="keyword">return</span> res.send(&#123; <span class="attr">status</span>: <span class="number">502</span>, <span class="attr">msg</span>: <span class="string">'用户名已存在'</span> &#125;);</span><br><span class="line">        data.ctime = moment().format(<span class="string">'YY-MM-DD hh:mm:ss'</span>);<span class="comment">//第三方中间件生成固定格式时间</span></span><br><span class="line">        <span class="keyword">const</span> sql2 = <span class="string">'insert into blogUser set ?'</span>;</span><br><span class="line">        conn.query(sql2, data, (err, result) =&gt; &#123;</span><br><span class="line">            <span class="keyword">if</span> (err) <span class="keyword">return</span> res.send(&#123; <span class="attr">status</span>: <span class="number">504</span>, <span class="attr">msg</span>: <span class="string">'注册新用户失败'</span> &#125;);</span><br><span class="line">            <span class="keyword">if</span> (result.affectedRows == <span class="number">1</span>) <span class="keyword">return</span> res.send(&#123; <span class="attr">status</span>: <span class="number">200</span>, <span class="attr">msg</span>: <span class="string">'ok'</span> &#125;);</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h3 id="5-登录功能的实现—-gt-login"><a href="#5-登录功能的实现—-gt-login" class="headerlink" title="5.登录功能的实现—&gt;login"></a>5.登录功能的实现—&gt;login<a name="5"></a></h3><h4 id="5-1-views-user-login-ejs"><a href="#5-1-views-user-login-ejs" class="headerlink" title="5.1 /views/user/login.ejs"></a>5.1 /views/user/login.ejs</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"/node_modules/jquery/dist/jquery.min.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript">    $(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">      $(<span class="string">'#form'</span>).on(<span class="string">'submit'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">e</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        $.ajax(&#123;</span></span><br><span class="line"><span class="javascript">          url: <span class="string">'/login'</span>,</span></span><br><span class="line"><span class="javascript">          data: $(<span class="string">'#form'</span>).serialize(),<span class="comment">//应在客户端实现初步验证</span></span></span><br><span class="line"><span class="javascript">          type: <span class="string">'POST'</span>,</span></span><br><span class="line"><span class="javascript">          dataType: <span class="string">'json'</span>,</span></span><br><span class="line"><span class="javascript">          success: <span class="function"><span class="keyword">function</span> (<span class="params">res</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">if</span> (res.status !== <span class="number">200</span>) &#123;</span></span><br><span class="line"><span class="javascript">              <span class="comment">// 登录失败</span></span></span><br><span class="line"><span class="javascript">              <span class="keyword">return</span> alert(res.msg)</span></span><br><span class="line"><span class="undefined">            &#125;</span></span><br><span class="line"><span class="javascript">            location.href = <span class="string">'/'</span></span></span><br><span class="line"><span class="undefined">          &#125;</span></span><br><span class="line"><span class="undefined">        &#125;)</span></span><br><span class="line"><span class="undefined">          </span></span><br><span class="line"><span class="javascript">        <span class="keyword">return</span> <span class="literal">false</span>; <span class="comment">//e.preventDefault() 阻止表单默认提交</span></span></span><br><span class="line"><span class="undefined">      &#125;)</span></span><br><span class="line"><span class="undefined">    &#125;)</span></span><br><span class="line"><span class="undefined">  </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="5-2-app-js"><a href="#5-2-app-js" class="headerlink" title="5.2  app.js"></a>5.2  app.js</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> session=<span class="built_in">require</span>(<span class="string">'express-session'</span>);</span><br><span class="line">app.use(session(&#123;</span><br><span class="line">    secret: <span class="string">'keyboard cat'</span>, <span class="comment">// 相当于是一个加密密钥，值可以是任意字符串</span></span><br><span class="line">    resave: <span class="literal">false</span>, <span class="comment">// 强制session保存到session store中</span></span><br><span class="line">    saveUninitialized: <span class="literal">false</span> <span class="comment">// 强制没有“初始化”的session保存到storage中</span></span><br><span class="line">  &#125;))</span><br><span class="line"></span><br><span class="line">app.post(<span class="string">'/login'</span>,(req,res)=&gt;&#123;</span><br><span class="line">    <span class="keyword">const</span> data = req.body;</span><br><span class="line">    sql = <span class="string">'select * from bloguser where username=? and password=?'</span>;</span><br><span class="line">    conn.query(sql, [data.username, data.password], (err, result) =&gt; &#123;</span><br><span class="line">        <span class="keyword">if</span> (err) <span class="keyword">return</span> res.send(&#123; <span class="attr">status</span>: <span class="number">501</span>, <span class="attr">msg</span>: <span class="string">'查询用户名失败'</span> &#125;);</span><br><span class="line">        <span class="keyword">if</span> (result.length == <span class="number">0</span>) <span class="keyword">return</span> res.send(&#123; <span class="attr">status</span>: <span class="number">502</span>, <span class="attr">msg</span>: <span class="string">'用户不存在'</span> &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//将登录的用户存在session中,设置是否登陆标志islogin</span></span><br><span class="line">        req.session.user = result[<span class="number">0</span>];</span><br><span class="line">        req.session.islogin = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">        res.send(&#123; <span class="attr">status</span>: <span class="number">200</span>, <span class="attr">msg</span>: <span class="string">'登录成功'</span> &#125;);</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h4 id="5-3-views-index-ejs"><a href="#5-3-views-index-ejs" class="headerlink" title="5.3 /views/index.ejs"></a>5.3 /views/index.ejs</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"collapse navbar-collapse"</span> <span class="attr">id</span>=<span class="string">"bs-example-navbar-collapse-1"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">   <span class="tag">&lt;<span class="name">%</span> <span class="attr">if</span>(<span class="attr">islogin</span>)&#123;%&gt;</span></span><br><span class="line">   	<span class="comment">&lt;!-- 用户名注销 --&gt;</span></span><br><span class="line">   	<span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"nav navbar-nav navbar-right navbar-form"</span>&gt;</span></span><br><span class="line">   		<span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">"btn btn-warning"</span>&gt;</span>你好<span class="tag">&lt;<span class="name">strong</span>&gt;</span><span class="tag">&lt;<span class="name">%=user.username%</span>&gt;</span><span class="tag">&lt;/<span class="name">strong</span>&gt;</span><span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">"btn btn-danger"</span> <span class="attr">href</span>=<span class="string">"/logout"</span>&gt;</span>注销<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">ul</span> <span class="attr">class</span>=<span class="string">"nav navbar-nav navbar-right"</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"dropdown"</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"#"</span> <span class="attr">class</span>=<span class="string">"dropdown-toggle"</span> <span class="attr">data-toggle</span>=<span class="string">"dropdown"</span> <span class="attr">role</span>=<span class="string">"button"</span> <span class="attr">aria-haspopup</span>=<span class="string">"true"</span> <span class="attr">aria-expanded</span>=<span class="string">"false"</span>&gt;</span>发表 <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"caret"</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">ul</span> <span class="attr">class</span>=<span class="string">"dropdown-menu"</span>&gt;</span></span><br><span class="line">             <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"#"</span>&gt;</span>文章<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">             <span class="tag">&lt;<span class="name">li</span> <span class="attr">role</span>=<span class="string">"separator"</span> <span class="attr">class</span>=<span class="string">"divider"</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">             <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"#"</span>&gt;</span>问题<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">%</span> &#125;<span class="attr">else</span>&#123; %&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 登录注册 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"nav navbar-nav navbar-right navbar-form"</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">"btn btn-success"</span> <span class="attr">href</span>=<span class="string">"/login"</span>&gt;</span>登录<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">"btn btn-primary"</span> <span class="attr">href</span>=<span class="string">"/register"</span>&gt;</span>注册<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">%</span> &#125; %&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="6-按功能抽离模块—-gt-router和-controller"><a href="#6-按功能抽离模块—-gt-router和-controller" class="headerlink" title="6.按功能抽离模块—&gt;/router和/controller"></a>6.按功能抽离模块—&gt;/router和/controller<a name="6"></a></h3><h4 id="6-1-app-js"><a href="#6-1-app-js" class="headerlink" title="6.1 app.js"></a>6.1 app.js</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>);</span><br><span class="line"><span class="keyword">const</span> app = express();</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> bodyParser = <span class="built_in">require</span>(<span class="string">'body-parser'</span>);</span><br><span class="line">app.use(bodyParser.urlencoded(&#123; <span class="attr">extended</span>: <span class="literal">false</span> &#125;));</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> session=<span class="built_in">require</span>(<span class="string">'express-session'</span>);</span><br><span class="line">app.use(session(&#123;</span><br><span class="line">    secret: <span class="string">'keyboard cat'</span>, <span class="comment">// 相当于是一个加密密钥，值可以是任意字符串</span></span><br><span class="line">    resave: <span class="literal">false</span>, <span class="comment">// 强制session保存到session store中</span></span><br><span class="line">    saveUninitialized: <span class="literal">false</span> <span class="comment">// 强制没有“初始化”的session保存到storage中</span></span><br><span class="line">  &#125;))</span><br><span class="line"></span><br><span class="line">app.use(<span class="string">'/node_modules'</span>, express.static(<span class="string">'./node_modules'</span>));</span><br><span class="line">app.set(<span class="string">'view engine'</span>, <span class="string">'ejs'</span>);</span><br><span class="line">app.set(<span class="string">'views'</span>, <span class="string">'./views'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> indexRouter=<span class="built_in">require</span>(<span class="string">'./router/index.js'</span>);</span><br><span class="line">app.use(indexRouter);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> userRouter=<span class="built_in">require</span>(<span class="string">'./router/user.js'</span>);</span><br><span class="line">app.use(userRouter);</span><br><span class="line"></span><br><span class="line">app.listen(<span class="number">80</span>, () =&gt; <span class="built_in">console</span>.log(<span class="string">'server running at http://127.0.0.1'</span>));</span><br></pre></td></tr></table></figure>
<h4 id="6-2-router"><a href="#6-2-router" class="headerlink" title="6.2 /router"></a>6.2 /router</h4><p><strong>6.2.1 /router/index.js</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>);</span><br><span class="line"><span class="keyword">const</span> router = express.Router();</span><br><span class="line"><span class="keyword">const</span> ctrl=<span class="built_in">require</span>(<span class="string">'../controller/index.js'</span>);</span><br><span class="line">router.get(<span class="string">'/'</span>,ctrl.showIndexPage)</span><br><span class="line"><span class="built_in">module</span>.exports=router;</span><br></pre></td></tr></table></figure>
<p><strong>6.2.2 /router/user.js</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>);</span><br><span class="line"><span class="keyword">const</span> router = express.Router();</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> ctrl = <span class="built_in">require</span>(<span class="string">'../controller/user.js'</span>);</span><br><span class="line"></span><br><span class="line">router.get(<span class="string">'/register'</span>, ctrl.getReg);</span><br><span class="line">router.get(<span class="string">'/login'</span>, ctrl.getLogin);</span><br><span class="line">router.post(<span class="string">'/register'</span>, ctrl.reg);</span><br><span class="line">router.post(<span class="string">'/login'</span>, ctrl.login);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = router;</span><br></pre></td></tr></table></figure>
<h4 id="6-3-controller"><a href="#6-3-controller" class="headerlink" title="6.3 /controller"></a>6.3 /controller</h4><p><strong>6.3.1 /controller/index.js</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> showIndexPage=<span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    res.render(<span class="string">'index.ejs'</span>, &#123;</span><br><span class="line">        user:req.session.user,</span><br><span class="line">        islogin:req.session.islogin</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports=&#123;showIndexPage&#125;;</span><br></pre></td></tr></table></figure>
<p><strong>6.3.2 /controller/user.js</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> moment = <span class="built_in">require</span>(<span class="string">'moment'</span>);</span><br><span class="line"><span class="keyword">const</span> mysql = <span class="built_in">require</span>(<span class="string">'mysql'</span>);</span><br><span class="line"><span class="keyword">const</span> conn = mysql.createConnection(&#123;</span><br><span class="line">    host: <span class="string">'127.0.0.1'</span>,</span><br><span class="line">    user: <span class="string">'root'</span>,</span><br><span class="line">    password: <span class="string">'root'</span>,</span><br><span class="line">    database: <span class="string">'expressStudy'</span></span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">const</span> getReg = <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    res.render(<span class="string">'./user/register.ejs'</span>, &#123;&#125;);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> getLogin = <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    res.render(<span class="string">'./user/login.ejs'</span>, &#123;&#125;);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> reg = <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> data = req.body;</span><br><span class="line">    <span class="keyword">if</span> (data.username.trim().length == <span class="string">''</span> || data.password.trim().length == <span class="string">''</span> || data.nickname.trim().length == <span class="string">''</span>) <span class="keyword">return</span> res.send(&#123; <span class="attr">status</span>: <span class="number">501</span>, <span class="attr">msg</span>: <span class="string">'请输入完整的用户信息'</span> &#125;);</span><br><span class="line">    <span class="keyword">const</span> sql1 = <span class="string">'select count(*) as count from blogUser where username=?'</span>;</span><br><span class="line">    conn.query(sql1, data.username, (err, result) =&gt; &#123;</span><br><span class="line">        <span class="keyword">if</span> (err) <span class="keyword">return</span> res.send(&#123; <span class="attr">status</span>: <span class="number">502</span>, <span class="attr">msg</span>: <span class="string">'查询用户名失败'</span> &#125;);</span><br><span class="line">        <span class="keyword">if</span> (result[<span class="number">0</span>].count !== <span class="number">0</span>) <span class="keyword">return</span> res.send(&#123; <span class="attr">status</span>: <span class="number">502</span>, <span class="attr">msg</span>: <span class="string">'用户名已存在'</span> &#125;);</span><br><span class="line">        data.ctime = moment().format(<span class="string">'YY-MM-DD hh:mm:ss'</span>);</span><br><span class="line">        <span class="keyword">const</span> sql2 = <span class="string">'insert into blogUser set ?'</span>;</span><br><span class="line">        conn.query(sql2, data, (err, result) =&gt; &#123;</span><br><span class="line">            <span class="keyword">if</span> (err) <span class="keyword">return</span> res.send(&#123; <span class="attr">status</span>: <span class="number">504</span>, <span class="attr">msg</span>: <span class="string">'注册新用户失败'</span> &#125;);</span><br><span class="line">            <span class="keyword">if</span> (result.affectedRows == <span class="number">1</span>) <span class="keyword">return</span> res.send(&#123; <span class="attr">status</span>: <span class="number">200</span>, <span class="attr">msg</span>: <span class="string">'ok'</span> &#125;);</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> login = <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> data = req.body;</span><br><span class="line">    sql = <span class="string">'select * from bloguser where username=? and password=?'</span>;</span><br><span class="line">    conn.query(sql, [data.username, data.password], (err, result) =&gt; &#123;</span><br><span class="line">        <span class="keyword">if</span> (err) <span class="keyword">return</span> res.send(&#123; <span class="attr">status</span>: <span class="number">501</span>, <span class="attr">msg</span>: <span class="string">'查询用户名失败'</span> &#125;);</span><br><span class="line">        <span class="keyword">if</span> (result.length == <span class="number">0</span>) <span class="keyword">return</span> res.send(&#123; <span class="attr">status</span>: <span class="number">502</span>, <span class="attr">msg</span>: <span class="string">'用户不存在'</span> &#125;);</span><br><span class="line"></span><br><span class="line">        req.session.user = result[<span class="number">0</span>];</span><br><span class="line">        req.session.islogin = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">        res.send(&#123; <span class="attr">status</span>: <span class="number">200</span>, <span class="attr">msg</span>: <span class="string">'登录成功'</span> &#125;);</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> logout= <span class="function">(<span class="params">req,res</span>)=&gt;</span>&#123;</span><br><span class="line">    req.session.destroy(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        res.redirect(<span class="string">'/'</span>);</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    getReg,</span><br><span class="line">    getLogin,</span><br><span class="line">    reg,</span><br><span class="line">    login</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h3 id="7-注销功能的实现—-gt-logout"><a href="#7-注销功能的实现—-gt-logout" class="headerlink" title="7.注销功能的实现—&gt;logout"></a>7.注销功能的实现—&gt;logout<a name="7"></a></h3><h4 id="7-1-views-index-ejs"><a href="#7-1-views-index-ejs" class="headerlink" title="7.1  /views/index.ejs"></a>7.1  /views/index.ejs</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">"btn btn-danger"</span> <span class="attr">href</span>=<span class="string">"/logout"</span>&gt;</span>注销<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="7-2-controller-user-js"><a href="#7-2-controller-user-js" class="headerlink" title="7.2  /controller/user.js"></a>7.2  /controller/user.js</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> logout= <span class="function">(<span class="params">req,res</span>)=&gt;</span>&#123;</span><br><span class="line">    req.session.destroy(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        res.redirect(<span class="string">'/'</span>);<span class="comment">//跳转到首页</span></span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    getReg,</span><br><span class="line">    getLogin,</span><br><span class="line">    reg,</span><br><span class="line">    login,</span><br><span class="line">    logout</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h4 id="7-3-router-user-js"><a href="#7-3-router-user-js" class="headerlink" title="7.3 /router/user.js"></a>7.3 /router/user.js</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">router.get(<span class="string">'/logout'</span>, ctrl.logout);</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/04/16/post05/" data-id="cjujtssuh00005st376pspmku" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-post04" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/04/15/post04/" class="article-date">
  <time datetime="2019-04-15T02:20:57.741Z" itemprop="datePublished">2019-04-15</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/04/15/post04/">node.js review day02 布局</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><a href="#布局">web页面常用布局 —&gt;综合复习</a></p>
<p><a href="#1">1.table布局、HTML+CSS布局</a></p>
<p><a href="#2">2.PC及移动端页面适配方法</a></p>
<p>   <a href="#2.1">2.1 静态布局（Static Layout）</a></p>
<p>   <a href="#2.2">2.2 全适配:响应式布局+流式布局</a></p>
<p>​       <a href="#2.2.1">2.2.1 Viewport和媒体查询</a></p>
<p>​       <a href="#2.2.2">2.2.2 响应式布局（Responsive Layout）</a></p>
<p>​       <a href="#2.2.3">2.2.3 流式布局（Liquid Layout）</a></p>
<p>​       <a href="#2.2.4">2.2.4 自适应布局（Adaptive Layout）</a></p>
<p>   <a href="#2.3">2.3 移动端适配</a></p>
<h1 id="node-js-review-day02"><a href="#node-js-review-day02" class="headerlink" title="node.js review day02"></a>node.js review day02</h1><h3 id="web页面常用布局-—-gt-综合复习"><a href="#web页面常用布局-—-gt-综合复习" class="headerlink" title="web页面常用布局 —&gt;综合复习"></a>web页面常用布局 —&gt;综合复习<a name="布局"></a></h3><h4 id="1-table布局、HTML-CSS布局"><a href="#1-table布局、HTML-CSS布局" class="headerlink" title="1.table布局、HTML+CSS布局"></a>1.table布局、HTML+CSS布局<a name="1"></a></h4><h5 id="1-1-table布局"><a href="#1-1-table布局" class="headerlink" title="1.1 table布局"></a>1.1 table布局</h5><p>通过table元素将页面空间划分成若干个单元格，将文字或图片等元素放入单元格中，隐藏表格的边框，从而实现布局。这种布局方式也叫传统布局，目前主要使用在EDM(广告邮件中的页面)中。</p>
<p>优点：布局容易、快捷、兼容性好。<br>缺点：改动不便，需重新调整，工作量大。</p>
<h5 id="1-2-HTML-CSS布局"><a href="#1-2-HTML-CSS布局" class="headerlink" title="1.2 HTML+CSS布局"></a>1.2 HTML+CSS布局</h5><p>主要通过CSS样式设置来布局文字或图片等元素，需要用到CSS盒子模型、盒子类型、CSS浮动、CSS定位、CSS背景图定位等知识来布局。</p>
<p>优点：布局灵活、改动方便。<br>缺点：需考虑平台的兼容性。</p>
<h4 id="2-PC及移动端页面适配方法"><a href="#2-PC及移动端页面适配方法" class="headerlink" title="2.PC及移动端页面适配方法"></a>2.PC及移动端页面适配方法<a name="2"></a></h4><h5 id="2-1-静态布局（Static-Layout）"><a href="#2-1-静态布局（Static-Layout）" class="headerlink" title="2.1 静态布局（Static Layout）"></a>2.1 静态布局（Static Layout）<a name="2.1"></a></h5><p>即传统Web设计，网页上的所有元素的尺寸一律使用px作为单位。</p>
<p>1、布局特点：不管浏览器尺寸具体是多少，网页布局始终按照最初写代码时的布局来显示。常规的pc端网站都是静态（定宽度）布局的，也就是设置了min-width，这样的话，如果小于这个宽度就会出现滚动条，如果大于这个宽度则内容居中外加背景，这种设计常见于pc端。<br>2、设计方法：<br>　　<strong>PC：</strong>居中布局，所有样式使用绝对宽度/高度(px)，设计一个Layout，在屏幕宽高有调整时，使用横向和竖向的滚动条来查阅被遮掩部分。<br>　　<strong>移动设备：</strong>另外建立移动网站，单独设计一个布局，使用不同的域名如wap.或m.。</p>
<p>　   <strong>在移动端开发中采用静态布局的两种方式：</strong></p>
<p>　（1）在viewport meta标签上设置width=320，页面的各个元素也采用px作为单位。通过用JS动态修改标签的initial-scale使得页面等比缩放，从而刚好占满整个屏幕。</p>
<p>　（2）设在viewport meta标签上设置content”width=640,user-scalable=no，页面的各个元素也采用px作为单位。由于640px超出了手机宽度，浏览器会自动缩小页面至刚好全屏。</p>
<p>优点：这种布局方式对设计师和CSS编写者来说都是最简单的，亦没有兼容性问题。</p>
<p>缺点：显而易见，即不能根据用户的屏幕尺寸做出不同的表现。</p>
<h5 id="2-2-全适配-响应式布局-流式布局"><a href="#2-2-全适配-响应式布局-流式布局" class="headerlink" title="2.2 全适配:响应式布局+流式布局"></a>2.2 全适配:响应式布局+流式布局<a name="2.2"></a></h5><p><strong>2.2.1 Viewport和媒体查询<a name="2.2.1"></a></strong></p>
<p><strong>什么是 Viewport?</strong></p>
<p>在显示面积上手机屏幕相对桌面显示器要小很多，在几年前(现在也如此)大部分网站都是为桌面显示器浏览而设计，很少考虑到适应手机屏幕，所以如果用手机浏览大多网站时会出现问题，比如常见固定宽度的网页会出现横向竖向滑动条，当然这不算什么大问题；但如果是浏览流动布局的网页那情况会非常糟糕，设想一个宽度为30%的侧边栏对于320px手机屏幕而言也就96px，只能容纳8个12px的汉字，可阅读性非常差。<br>为了让手机也能获得良好的网页浏览体验，Apple找到了一个办法：在移动版(iOS)的Safari中定义了viewport meta标签，它的作用就是创建一个虚拟的窗口(viewport)，而且这个虚拟窗口的分辨率接近于桌面显示器，Apple将其定位为980px。以一代iphone下的Safari来说就是：<br>在iphone的320px物理屏幕上——视觉窗口(visual viewport)，创建出了一个980px的虚拟窗口——布局窗口(layout viewport)，在视觉窗口(visual viewport)中我们可以拖动横向竖向滑动条或者放大缩小网页，来达到最佳的浏览效果(类似桌面浏览器)；而布局窗口(layout viewport)用来配合CSS渲染布局，例如当我们设置一个容器的宽度为100%时，这个容器的实际值为980px而不是320px。如此一来大部分网页就能以缩放的形式正常的显示在手机屏幕上了。</p>
<p>有了layout viewport似乎解决手机浏览网页的难题，但如果遇到专门为手机优化的网页就又有新的问题：因为iphone的layout viewport默认为980px，导致专为其优化的320px宽的页面只能以缩放的方式显示，这时就需要对viewport进行设置：</p>
<p><meta name="”viewport”" content="”width=device-width," initial-scale="1.0," user-scalable="no”/"><br>这个是最常见的一条viewport meta代码，将viewport定义为：宽度为设备宽度，初始缩放比例为1倍，禁止用户缩放。设置好后我们的页面就显示完美了：viewport全部属性和值如下：<br>width: viewport宽度<br>height: viewport高度<br>initial-scale: 初始缩放比例<br>maximum-scale: 最大缩放比例<br>minimum-scale: 最小缩放比例<br>user-scalable: 是否允许用户缩放例：width=960 或 device-width<br>height=1000 或 device-height<br>initial-scale=0.5<br>maximum-scale=2<br>minimum-scale=1<br>user-scalable=1 或 0 (yes 或 no)</p>
<p>最后关注下width=device-width其实这个属性值很有意思，字面意应该是viewport宽度等于设备宽度（这里的设备宽度指的并不是物理像素而是设备独立像素，其中设备物理像素和设备独立像素比称为devicePixelRatio），浏览器给出了个定值：320px；这个值还是源于 Apple，因为早期iphone的分辨率为320px × 480px，大量为iphone量身定制的网站都设置了viewport:width=device-width，并且按照宽度320px来设计制作，所 以其他浏览器加入viewport支持时为了兼容性也将device-width定义为了320px。</p>
<p><strong>什么是媒体查询?</strong></p>
<p>1.关键字: and  not  only</p>
<p>1.引入方式</p>
<p>(1) link方式</p>
<link href="css路径" media="only screen and (max-width: 320px)">

<p>(2) @media方法（写在CSS里）</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">@<span class="keyword">media</span> screen and (min-width: <span class="number">320px</span>)</span><br></pre></td></tr></table></figure>
<p><strong>2.2.2 响应式布局（Responsive Layout）<a name="2.2.2"></a></strong></p>
<p><strong>响应式布局的原理</strong></p>
<p>CSS3中的Media Query（媒介查询）<br>通过查询screen的宽度来指定某个宽度区间的网页布局。<br>超小屏幕（移动设备）    768px以下<br>小屏设备    768px-992px<br>中等屏幕    992px-1200px<br>宽屏设备    1200px以上</p>
<table>
<thead>
<tr>
<th>开发方式</th>
<th>移动web开发+PC开发</th>
<th>响应式开发</th>
</tr>
</thead>
<tbody>
<tr>
<td>应用场景</td>
<td>一般在已经有PC端的网站，开发移动站的时候，只需单独开发移动端。</td>
<td>针对新建站的一些网站，现在要求适配移动端，所以就一套页面兼容各种终端，灵活。</td>
</tr>
<tr>
<td>开发</td>
<td>针对性强，开发效率高。</td>
<td>兼容各种终端，效率低。</td>
</tr>
<tr>
<td>适配</td>
<td>只适配 移动设备，pad上体验相对较差。</td>
<td>可以适配各种终端。</td>
</tr>
<tr>
<td>效率</td>
<td>代码简洁，加载快。</td>
<td>代码相对复杂，加载慢。</td>
</tr>
</tbody>
</table>
<p>bootstrap框架  3.3.7版本</p>
<p><strong>2.2.3 流式布局（Liquid Layout）<a name="2.2.3"></a></strong></p>
<p>流式布局（Liquid）的特点（也叫”Fluid”) 是页面元素的宽度按照屏幕分辨率进行适配调整，但整体布局不变。</p>
<p>网页中主要的划分区域的尺寸使用百分数（搭配min-<em>、max-</em>属性使用），例如，设置网页主体的宽度为80%，min-width为960px。图片也作类似处理（width:100%, max-width一般设定为图片本身的尺寸，防止被拉伸而失真）。</p>
<p>1、布局特点：屏幕分辨率变化时，页面里元素的大小会变化而但布局不变。【这就导致如果屏幕太大或者太小都会导致元素无法正常显示】</p>
<p>2、设计方法：使用%百分比定义宽度，高度大都是用px来固定住，可以根据可视区域 (viewport) 和父元素的实时尺寸进行调整，尽可能的适应各种分辨率。往往配合 max-width/min-width 等属性控制尺寸流动范围以免过大或者过小影响阅读。</p>
<p><strong>这种布局方式在Web前端开发的早期历史上，用来应对不同尺寸的PC屏幕</strong>（那时屏幕尺寸的差异不会太大），<strong>在当今的移动端开发也是常用布局方式</strong>，但<strong>缺点明显</strong>：<strong>主要的问题</strong>是如果屏幕尺度跨度太大，那么在相对其原始设计而言过小或过大的屏幕上不能正常显示。因为宽度使用%百分比定义，但是高度和文字大小等大都是用px来固定，所以在大屏幕的手机下显示效果会变成有些页面元素宽度被拉的很长，但是高度、文字大小还是和原来一样（即，这些东西无法变得“流式”），显示非常不协调。</p>
<p><strong>2.2.4 自适应布局（Adaptive Layout）<a name="2.2.4"></a></strong><br>自适应布局的特点是分别为不同的屏幕分辨率定义布局，即创建多个静态布局，每个静态布局对应一个屏幕分辨率范围。改变屏幕分辨率可以切换不同的静态局部（页面元素位置发生改变），但在每个静态布局中，页面元素不随窗口大小的调整发生变化。可以把自适应布局看作是静态布局的一个系列。<br>1、布局特点：屏幕分辨率变化时，页面里面元素的位置会变化而大小不会变化。<br>2、设计方法：使用 @media 媒体查询给不同尺寸和介质的设备切换不同的样式。在优秀的响应范围设计下可以给适配范围内的设备最好的体验，在同一个设备下实际还是固定的布局。</p>
<h5 id="2-3-移动端适配"><a href="#2-3-移动端适配" class="headerlink" title="2.3 移动端适配"></a>2.3 移动端适配</h5><p><strong>2.3.1 通过媒体查询的方式即CSS3的meida queries</strong></p>
<p><code>meida queries</code> 的方式主要是通过查询设备的宽度来执行不同的 <code>css</code> 代码，最终达到界面的配置。核心语法是：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">@<span class="keyword">media</span> screen and (max-width: <span class="number">600px</span>) &#123; <span class="comment">/*当屏幕尺寸小于600px时，应用下面的CSS样式*/</span></span><br><span class="line">  <span class="comment">/*css代码*/</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>优点</strong></p>
<ul>
<li><p>media query可以做到设备像素比的判断，方法简单，成本低，特别是对移动和PC维护同一套代码的时候。目前像Bootstrap等框架使用这种方式布局</p>
</li>
<li><p>图片便于修改，只需修改css文件</p>
</li>
<li>调整屏幕宽度的时候不用刷新页面即可响应式展示</li>
</ul>
<p><strong>缺点</strong></p>
<ul>
<li>代码量比较大，维护不方便</li>
<li>为了兼顾大屏幕或高清设备，会造成其他设备资源浪费，特别是加载图片资源</li>
<li>为了兼顾移动端和PC端各自响应式的展示效果，难免会损失各自特有的交互方式</li>
</ul>
<p><strong>2.3.2 以天猫首页为代表的 flex 弹性布局</strong></p>
<p><code>viewport</code>是固定的：<code>&lt;meta name=&quot;viewport&quot; content=&quot;width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no&quot;&gt;</code> </p>
<p>高度定死，宽度自适应，元素都采用<code>px</code>做单位。</p>
<p>随着屏幕宽度变化，页面也会跟着变化，效果就和PC页面的流体布局差不多，在哪个宽度需要调整的时候使用响应式布局调调就行（比如网易新闻），这样就实现了『适配』。</p>
<p><strong>2.3.3  rem+viewport缩放</strong></p>
<p>根据屏幕宽度设定 <code>rem</code> 值，需要适配的元素都使用 <code>rem</code> 为单位，不需要适配的元素还是使用 <code>px</code> 为单位。（1em = 16px）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">rem是CSS3新增的一个相对单位（root em，根em），这个单位与em有什么区别呢？</span><br><span class="line">区别在于使用rem为元素设定字体大小时，仍然是相对大小，但相对的只是HTML根元素。这个单位可谓集相对大小和绝对大小的优点于一身，通过它既可以做到只修改根元素就成比例地调整所有字体大小，又可以避免字体大小逐层复合的连锁反应。目前，除了IE8及更早版本外，所有浏览器均已支持rem。对于不支持它的浏览器，应对方法也很简单，就是多写一个绝对单位的声明。这些浏览器会忽略用rem设定的字体大小。比如：</span><br><span class="line">p&#123;font-size:14px;font-size:0.875rem;&#125;</span><br></pre></td></tr></table></figure>
<p>实现原理<br>根据rem将页面放大dpr倍, 然后viewport设置为1/dpr.</p>
<p>如iphone5的dpr为2, 则页面整体放大3倍, 1px(css单位)在iphone5下默认为2px(物理像素) </p>
<p>然后viewport设置为1/2, 这样页面整体缩回原始大小. 从而实现高清。 </p>
<p><code>&lt;meta name=&quot;viewport&quot; content=&quot;initial-scale=0.5,maximum-scale=0.5,minimum-scale=0.5,user-scalable=no&quot;&gt;</code></p>
<p>这样整个网页在设备内显示时的页面宽度就会等于设备逻辑像素大小，也就是device-width。<br>这个device-width的计算公式为：设备的物理分辨率/(devicePixelRatio * scale)， </p>
<p>在scale为1的情况下，device-width = 设备的物理分辨率/devicePixelRatio 。</p>
<p><strong>2.3.4 rem 方式</strong></p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">@<span class="keyword">media</span> screen and (min-width: <span class="number">320px</span>) &#123;<span class="selector-tag">html</span>&#123;<span class="attribute">font-size</span>:<span class="number">50px</span>;&#125;&#125;</span><br><span class="line">@<span class="keyword">media</span> screen and (min-width: <span class="number">360px</span>) &#123;<span class="selector-tag">html</span>&#123;<span class="attribute">font-size</span>:<span class="number">56.25px</span>;&#125;&#125;</span><br><span class="line">@<span class="keyword">media</span> screen and (min-width: <span class="number">375px</span>) &#123;<span class="selector-tag">html</span>&#123;<span class="attribute">font-size</span>:<span class="number">58.59375px</span>;&#125;&#125;</span><br><span class="line">@<span class="keyword">media</span> screen and (min-width: <span class="number">400px</span>) &#123;<span class="selector-tag">html</span>&#123;<span class="attribute">font-size</span>:<span class="number">62.5px</span>;&#125;&#125;</span><br><span class="line">@<span class="keyword">media</span> screen and (min-width: <span class="number">414px</span>) &#123;<span class="selector-tag">html</span>&#123;<span class="attribute">font-size</span>:<span class="number">64.6875px</span>;&#125;&#125;</span><br><span class="line">@<span class="keyword">media</span> screen and (min-width: <span class="number">440px</span>) &#123;<span class="selector-tag">html</span>&#123;<span class="attribute">font-size</span>:<span class="number">68.75px</span>;&#125;&#125;</span><br><span class="line">@<span class="keyword">media</span> screen and (min-width: <span class="number">480px</span>) &#123;<span class="selector-tag">html</span>&#123;<span class="attribute">font-size</span>:<span class="number">75px</span>;&#125;&#125;</span><br><span class="line">@<span class="keyword">media</span> screen and (min-width: <span class="number">520px</span>) &#123;<span class="selector-tag">html</span>&#123;<span class="attribute">font-size</span>:<span class="number">81.25px</span>;&#125;&#125;</span><br><span class="line">@<span class="keyword">media</span> screen and (min-width: <span class="number">560px</span>) &#123;<span class="selector-tag">html</span>&#123;<span class="attribute">font-size</span>:<span class="number">87.5px</span>;&#125;&#125;</span><br><span class="line">@<span class="keyword">media</span> screen and (min-width: <span class="number">600px</span>) &#123;<span class="selector-tag">html</span>&#123;<span class="attribute">font-size</span>:<span class="number">93.75px</span>;&#125;&#125;</span><br><span class="line">@<span class="keyword">media</span> screen and (min-width: <span class="number">640px</span>) &#123;<span class="selector-tag">html</span>&#123;<span class="attribute">font-size</span>:<span class="number">100px</span>;&#125;&#125;</span><br><span class="line">@<span class="keyword">media</span> screen and (min-width: <span class="number">680px</span>) &#123;<span class="selector-tag">html</span>&#123;<span class="attribute">font-size</span>:<span class="number">106.25px</span>;&#125;&#125;</span><br><span class="line">@<span class="keyword">media</span> screen and (min-width: <span class="number">720px</span>) &#123;<span class="selector-tag">html</span>&#123;<span class="attribute">font-size</span>:<span class="number">112.5px</span>;&#125;&#125;</span><br><span class="line">@<span class="keyword">media</span> screen and (min-width: <span class="number">760px</span>) &#123;<span class="selector-tag">html</span>&#123;<span class="attribute">font-size</span>:<span class="number">118.75px</span>;&#125;&#125;</span><br><span class="line">@<span class="keyword">media</span> screen and (min-width: <span class="number">800px</span>) &#123;<span class="selector-tag">html</span>&#123;<span class="attribute">font-size</span>:<span class="number">125px</span>;&#125;&#125;</span><br><span class="line">@<span class="keyword">media</span> screen and (min-width: <span class="number">960px</span>) &#123;<span class="selector-tag">html</span>&#123;<span class="attribute">font-size</span>:<span class="number">150px</span>;&#125;&#125;</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/04/15/post04/" data-id="cjujtssyy00035st3msja87mw" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-post03" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/04/14/post03/" class="article-date">
  <time datetime="2019-04-14T09:54:52.790Z" itemprop="datePublished">2019-04-14</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/04/14/post03/">node.js study day06 &amp; 全屏和视频播放复习</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><a href="#web_server"><em>web_server</em>—&gt;day05文件夹</a></p>
<p>​     semantic-ui —&gt;ui框架</p>
<p><a href="#全屏API">全屏API—&gt;复习</a></p>
<p><a href="#视频播放API">视频播放API—&gt;复习</a></p>
<h2 id="node-js-study-day06-amp-全屏和视频播放复习"><a href="#node-js-study-day06-amp-全屏和视频播放复习" class="headerlink" title="node.js study day06 &amp; 全屏和视频播放复习"></a>node.js study day06 &amp; 全屏和视频播放复习</h2><h3 id="web-server—-gt-day05文件夹"><a href="#web-server—-gt-day05文件夹" class="headerlink" title="web_server—&gt;day05文件夹"></a><em>web_server</em>—&gt;day05文件夹<a name="web_server"></a></h3><h4 id="1-准备工作"><a href="#1-准备工作" class="headerlink" title="1.准备工作"></a>1.准备工作</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">//cmd中运行:</span><br><span class="line">npm i gulp -g</span><br><span class="line">//新建文件后运行:</span><br><span class="line">yarn init -y</span><br><span class="line">yarn add express</span><br><span class="line">yarn add jquery</span><br><span class="line">yarn add art-template</span><br></pre></td></tr></table></figure>
<h4 id="2-根目录下创建app-js文件"><a href="#2-根目录下创建app-js文件" class="headerlink" title="2.根目录下创建app.js文件"></a>2.根目录下创建app.js文件</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> express=<span class="built_in">require</span>(<span class="string">'express'</span>);</span><br><span class="line"><span class="keyword">const</span> app=express();</span><br><span class="line">app.use(express.static(<span class="string">'./views'</span>));<span class="comment">//127.0.0.1:3000=&gt;127.0.0.1:3000/views/index.html</span></span><br><span class="line">app.use(<span class="string">'/node_modules'</span>,express.static(<span class="string">'./node_modules'</span>));<span class="comment">/* 添加第一个参数虚拟路径('/'表示根路径127.0.0.1,添加后请求路径为127.0.0.1/node_modules),与views文件夹下引入文件路径一致 */</span></span><br><span class="line">app.use(<span class="string">'/semantic'</span>,express.static(<span class="string">'./semantic'</span>));</span><br><span class="line">app.listen(<span class="number">3000</span>,()=&gt;<span class="built_in">console</span>.log(<span class="string">'server running at http://127.0.0.1:3000'</span>));</span><br></pre></td></tr></table></figure>
<h4 id="3-创建子文件夹views-其下创建index-html"><a href="#3-创建子文件夹views-其下创建index-html" class="headerlink" title="3.创建子文件夹views,其下创建index.html"></a>3.创建子文件夹views,其下创建index.html</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span> <span class="attr">content</span>=<span class="string">"width=device-width, initial-scale=1.0"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"X-UA-Compatible"</span> <span class="attr">content</span>=<span class="string">"ie=edge"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>英雄列表<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 引入文件均为相对路径 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">href</span>=<span class="string">"../semantic/dist/semantic.css"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">href</span>=<span class="string">"./index.css"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"../node_modules/jquery/dist/jquery.min.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"../semantic/dist/semantic.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 在浏览器端解析模板 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"../node_modules/art-template/lib/template-web.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"./index.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h2</span>&gt;</span>英雄列表<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- ui primary button蓝色按钮 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">"ui primary button showModal"</span>&gt;</span></span><br><span class="line">        添加英雄</span><br><span class="line">    <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- tiny盒子宽度 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"ui modal tiny"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"header"</span>&gt;</span></span><br><span class="line">            添加新英雄</span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"content"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">form</span> <span class="attr">class</span>=<span class="string">"ui form"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"field"</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">label</span>&gt;</span>名称:<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"name"</span> <span class="attr">placeholder</span>=<span class="string">"请输入英雄名称"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"field"</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">label</span>&gt;</span>性别:<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">select</span> <span class="attr">class</span>=<span class="string">"ui dropdown"</span> <span class="attr">name</span>=<span class="string">"gender"</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">"男"</span>&gt;</span>男<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">"女"</span>&gt;</span>女<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"actions"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"ui black deny button"</span>&gt;</span></span><br><span class="line">                取消</span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"ui positive right button addHeroBtn"</span>&gt;</span></span><br><span class="line">                添加</span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">table</span> <span class="attr">class</span>=<span class="string">"ui celled blue table"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">thead</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">th</span>&gt;</span>状态<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">th</span>&gt;</span>名称<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">th</span>&gt;</span>性别<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">th</span>&gt;</span>创建时间<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">th</span>&gt;</span>操作<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">thead</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tbody</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 英雄坑 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">tbody</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/template"</span> <span class="attr">id</span>=<span class="string">"heroTpl"</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="undefined">        &#123;&#123;each data&#125;&#125;</span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">td</span>&gt;</span></span></span><br><span class="line"><span class="javascript">                &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"ui ribbon label &#123;&#123;$value.isdel=='0'?'blue':'red'&#125;&#125;"</span>&gt;&#123;&#123;$value.isdel==<span class="string">'0'</span>?<span class="string">'正常'</span>:<span class="string">'删除'</span>&#125;&#125;&lt;<span class="regexp">/div&gt;</span></span></span><br><span class="line"><span class="undefined">                &#123;&#123;$value.id&#125;&#125;</span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123;$value.name&#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123;$value.gender&#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123;$value.ctime&#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">td</span>&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"javascript:;"</span>&gt;</span>编辑<span class="tag">&lt;/<span class="name">a</span>&gt;</span> </span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"javascript:;"</span>&gt;</span>删除<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span></span><br><span class="line"><span class="undefined">        &#123;&#123;/each&#125;&#125;</span></span><br><span class="line"><span class="undefined">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">getHeros</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        $.ajax(&#123;</span><br><span class="line">            type: <span class="string">'get'</span>,</span><br><span class="line">            url: <span class="string">'http://127.0.0.1:5000/getAllHero'</span>,</span><br><span class="line">            success: <span class="function"><span class="keyword">function</span> (<span class="params">res</span>) </span>&#123;</span><br><span class="line">                <span class="built_in">console</span>.log(res);</span><br><span class="line">                <span class="keyword">var</span> html = template(<span class="string">'heroTpl'</span>, res);</span><br><span class="line">                $(<span class="string">'tbody'</span>).html(html);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    getHeros();</span><br><span class="line"></span><br><span class="line">    $(<span class="string">'.showModal'</span>).on(<span class="string">'click'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        $(<span class="string">'.ui.modal'</span>).modal(<span class="string">'show'</span>);</span><br><span class="line">    &#125;)</span><br><span class="line">    $(<span class="string">'.ui.dropdown'</span>).dropdown();<span class="comment">//初始化select标签dropdown盒子动效</span></span><br><span class="line">    $(<span class="string">'.addHeroBtn'</span>).on(<span class="string">'click'</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        $.ajax(&#123;</span><br><span class="line">            type:<span class="string">'post'</span>,</span><br><span class="line">            url:<span class="string">'http://127.0.0.1:5000/addHero'</span>,</span><br><span class="line">            data:$(<span class="string">'form'</span>).serialize(),</span><br><span class="line">            dataType:<span class="string">'json'</span>,</span><br><span class="line">            success:<span class="function"><span class="keyword">function</span>(<span class="params">res</span>)</span>&#123;</span><br><span class="line">                <span class="built_in">console</span>.log(res);</span><br><span class="line">                <span class="keyword">if</span>(res.status==<span class="number">200</span>)&#123;</span><br><span class="line">                    getHeros();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h4 id="4-semantic-ui"><a href="#4-semantic-ui" class="headerlink" title="4.semantic-ui"></a>4.semantic-ui</h4><p>注意:semantic-ui通过npm下载会卡,直接引入css和js文件即可,引入js文件前需引入jquery.js文件</p>
<h3 id="全屏API—-gt-复习"><a href="#全屏API—-gt-复习" class="headerlink" title="全屏API—&gt;复习"></a>全屏API—&gt;复习<a name="全屏API"></a></h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"图片路径"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">"btn1"</span>&gt;</span>全屏显示<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">"btn2"</span>&gt;</span>退出全屏<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">"btn3"</span>&gt;</span>是否全屏<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript">        <span class="comment">// requestFullScreen</span></span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> div=<span class="built_in">document</span>.querySelector(<span class="string">'div'</span>);</span></span><br><span class="line"><span class="javascript">        <span class="built_in">document</span>.querySelector(<span class="string">'#btn1'</span>).onclick=<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">if</span>(div.msRequestFullscreen)&#123;</span></span><br><span class="line"><span class="undefined">                div.msRequestFullscreen();</span></span><br><span class="line"><span class="javascript">            &#125;<span class="keyword">else</span> <span class="keyword">if</span>(div.webkitRequestFullScreen)&#123;</span></span><br><span class="line"><span class="undefined">                div.webkitRequestFullScreen();</span></span><br><span class="line"><span class="javascript">            &#125;<span class="keyword">else</span> <span class="keyword">if</span>(div.mozRequestFullScreen)&#123;</span></span><br><span class="line"><span class="undefined">                div.mozRequestFullScreen();</span></span><br><span class="line"><span class="undefined">            &#125;</span></span><br><span class="line"><span class="undefined">        &#125;</span></span><br><span class="line"><span class="javascript">        <span class="comment">// cancelFullScreen</span></span></span><br><span class="line"><span class="javascript">        <span class="built_in">document</span>.querySelector(<span class="string">'#btn2'</span>).onclick=<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">if</span>(<span class="built_in">document</span>.msCancelFullScreen)&#123;</span></span><br><span class="line"><span class="javascript">                <span class="built_in">document</span>.msCancelFullScreen();</span></span><br><span class="line"><span class="javascript">            &#125;<span class="keyword">else</span> <span class="keyword">if</span>(<span class="built_in">document</span>.webkitCancelFullScreen)&#123;</span></span><br><span class="line"><span class="javascript">                <span class="built_in">document</span>.webkitCancelFullScreen();</span></span><br><span class="line"><span class="javascript">            &#125;<span class="keyword">else</span> <span class="keyword">if</span>(<span class="built_in">document</span>.mozCancelFullScreen)&#123;</span></span><br><span class="line"><span class="javascript">                <span class="built_in">document</span>.mozCancelFullScreen();</span></span><br><span class="line"><span class="undefined">            &#125;</span></span><br><span class="line"><span class="undefined">        &#125;</span></span><br><span class="line"><span class="javascript">        <span class="comment">// fullScreenElement</span></span></span><br><span class="line"><span class="javascript">        <span class="built_in">document</span>.querySelector(<span class="string">'#btn3'</span>).onclick=<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">if</span>(<span class="built_in">document</span>.msFullscreenElement||<span class="built_in">document</span>.webkitFullscreenElement||<span class="built_in">document</span>.mozFullScreenElement)&#123;</span></span><br><span class="line"><span class="javascript">                alert(<span class="literal">true</span>);</span></span><br><span class="line"><span class="javascript">            &#125;<span class="keyword">else</span>&#123;</span></span><br><span class="line"><span class="javascript">                alert(<span class="literal">false</span>);</span></span><br><span class="line"><span class="undefined">            &#125;</span></span><br><span class="line"><span class="undefined">        &#125;</span></span><br><span class="line"><span class="undefined">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="视频播放API—-gt-复习"><a href="#视频播放API—-gt-复习" class="headerlink" title="视频播放API—&gt;复习"></a>视频播放API—&gt;复习<a name="视频播放API"></a></h3><h4 id="1-videoPlayer-html"><a href="#1-videoPlayer-html" class="headerlink" title="1.videoPlayer.html"></a>1.videoPlayer.html</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line">    </span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span> <span class="attr">content</span>=<span class="string">"width=device-width,initial-scale=1.0"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"X-UA-Compatible"</span> <span class="attr">content</span>=<span class="string">"ie=edge"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>视频播放<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">href</span>=<span class="string">"./font-awesome.css"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">href</span>=<span class="string">"videoPlayer.css"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">    </span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"player"</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 视频盒子 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"videoContent"</span>&gt;</span> </span><br><span class="line">            <span class="comment">&lt;!-- muted静音属性,浏览器解析时缺少muted不能自动播放 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">video</span> <span class="attr">src</span>=<span class="string">"视频路径"</span> <span class="attr">muted</span>&gt;</span><span class="tag">&lt;/<span class="name">video</span>&gt;</span> </span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 控制条盒子 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"controls"</span>&gt;</span> </span><br><span class="line">            <span class="comment">&lt;!-- 播放暂停按钮 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"#"</span> <span class="attr">class</span>=<span class="string">"switch fa fa-play"</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 全屏按钮 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"#"</span> <span class="attr">class</span>=<span class="string">"expand fa fa-expand"</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 底层进度条 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"progress"</span>&gt;</span>  </span><br><span class="line">                <span class="comment">&lt;!-- 点击进度条按百分比播放 --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"bar"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span> </span><br><span class="line">                <span class="comment">&lt;!-- 下载部分 --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"loaded"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span> </span><br><span class="line">                <span class="comment">&lt;!-- 播放部分 --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"elapsed"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span> </span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"time"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"currentTime"</span>&gt;</span>00:00:00<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"totalTime"</span>&gt;</span>00:00:00<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"/jquery.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> video=$(<span class="string">'video'</span>)[<span class="number">0</span>];</span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> totalTime;</span></span><br><span class="line"><span class="javascript">        video.oncanplay=<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">            setTimeout(<span class="function"><span class="params">()</span>=&gt;</span>&#123;</span></span><br><span class="line"><span class="javascript">                <span class="keyword">this</span>.style.display=<span class="string">'block'</span>;</span></span><br><span class="line"><span class="javascript">                totalTime=<span class="built_in">Math</span>.floor(<span class="keyword">this</span>.duration);<span class="comment">//视频总时长</span></span></span><br><span class="line"><span class="javascript">                $(<span class="string">'.totalTime'</span>).text(getTime(totalTime));</span></span><br><span class="line"><span class="javascript">                $(<span class="string">'.bar'</span>).css(<span class="string">'zIndex'</span>,<span class="string">'3'</span>);</span></span><br><span class="line"><span class="undefined">            &#125;,2000) </span></span><br><span class="line"><span class="undefined">        &#125;</span></span><br><span class="line"><span class="javascript">        <span class="comment">//时间格式函数</span></span></span><br><span class="line"><span class="javascript">        <span class="function"><span class="keyword">function</span> <span class="title">getTime</span>(<span class="params">time</span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">var</span> hours=<span class="built_in">Math</span>.floor(time/<span class="number">3600</span>).toString().padStart(<span class="number">2</span>,<span class="string">'0'</span>);</span></span><br><span class="line"><span class="javascript">            <span class="keyword">var</span> minutes=<span class="built_in">Math</span>.floor(time%<span class="number">3600</span>/<span class="number">60</span>).toString().padStart(<span class="number">2</span>,<span class="string">'0'</span>);</span></span><br><span class="line"><span class="javascript">            <span class="keyword">var</span> seconds=<span class="built_in">Math</span>.floor(time%<span class="number">60</span>).toString().padStart(<span class="number">2</span>,<span class="string">'0'</span>);</span></span><br><span class="line"><span class="javascript">            <span class="keyword">return</span> hours+<span class="string">':'</span>+ minutes + <span class="string">':'</span> + seconds;</span></span><br><span class="line"><span class="undefined">        &#125;</span></span><br><span class="line"><span class="undefined">        </span></span><br><span class="line"><span class="javascript">        video.ontimeupdate = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">var</span> currentTime = <span class="built_in">Math</span>.floor(<span class="keyword">this</span>.currentTime);</span></span><br><span class="line"><span class="javascript">            $(<span class="string">'.currentTime'</span>).text(getTime(currentTime));</span></span><br><span class="line"><span class="javascript">            <span class="keyword">var</span> elapsedW = currentTime / totalTime * <span class="number">100</span> + <span class="string">'%'</span>;</span></span><br><span class="line"><span class="javascript">            $(<span class="string">'.elapsed'</span>).width(elapsedW);</span></span><br><span class="line"><span class="undefined">        &#125;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">        $(<span class="string">'.switch'</span>).click(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">if</span> (video.paused</span></span><br><span class="line"><span class="undefined">            ) &#123;</span></span><br><span class="line"><span class="undefined">                video.play();</span></span><br><span class="line"><span class="javascript">                <span class="keyword">this</span>.classList.remove(<span class="string">'fa-play'</span>);</span></span><br><span class="line"><span class="javascript">                <span class="keyword">this</span>.classList.add(<span class="string">'fa-pause'</span>);</span></span><br><span class="line"><span class="javascript">            &#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="undefined">                video.pause();</span></span><br><span class="line"><span class="javascript">                <span class="keyword">this</span>.classList.remove(<span class="string">'fa-pause'</span>);</span></span><br><span class="line"><span class="javascript">                <span class="keyword">this</span>.classList.add(<span class="string">'fa-play'</span>);</span></span><br><span class="line"><span class="undefined">            &#125;</span></span><br><span class="line"><span class="undefined">        &#125;)</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">        $(<span class="string">'.expand'</span>).click(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">if</span> (video.webkitRequestFullScreen) &#123;</span></span><br><span class="line"><span class="undefined">                video.webkitRequestFullScreen();</span></span><br><span class="line"><span class="javascript">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (video.mozRequestFullScreen) &#123;</span></span><br><span class="line"><span class="undefined">                video.mozRequestFullScreen();</span></span><br><span class="line"><span class="javascript">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (video.msRequestFullScreen) &#123;</span></span><br><span class="line"><span class="undefined">                video.msRequestFullScreen();</span></span><br><span class="line"><span class="undefined">            &#125;</span></span><br><span class="line"><span class="undefined">        &#125;)</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">        $(<span class="string">'.bar'</span>).click(<span class="function"><span class="keyword">function</span> (<span class="params">e</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">            video.currentTime = e.offsetX / $(<span class="keyword">this</span>).width() * totalTime;</span></span><br><span class="line"><span class="undefined">        &#125;)</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">        video.onended = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">            $(<span class="string">'.switch'</span>).removeClass(<span class="string">'fa-pause'</span>);</span></span><br><span class="line"><span class="javascript">            $(<span class="string">'.switch'</span>).addClass(<span class="string">'fa-play'</span>);</span></span><br><span class="line"><span class="undefined">            video.currentTime=0;</span></span><br><span class="line"><span class="undefined">        &#125;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="undefined">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="2-videoPlayer-css"><a href="#2-videoPlayer-css" class="headerlink" title="2.videoPlayer.css"></a>2.videoPlayer.css</h4><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line">* &#123;</span><br><span class="line">    <span class="attribute">margin</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-tag">a</span> &#123;</span><br><span class="line">    <span class="attribute">text-decoration</span>: none;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.player</span> &#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">720px</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">360px</span>;</span><br><span class="line">    <span class="attribute">margin</span>: <span class="number">0</span> auto;</span><br><span class="line">    <span class="attribute">margin-top</span>: <span class="number">80px</span>;</span><br><span class="line">    <span class="attribute">background</span>: <span class="built_in">url</span>(<span class="string">'视频缓冲时的图片路径'</span>) center center;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.videoContent</span> &#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">100%</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-tag">video</span> &#123;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">100%</span>;</span><br><span class="line">    <span class="attribute">margin</span>: <span class="number">0</span> auto;</span><br><span class="line">    <span class="attribute">display</span>: none;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.controls</span> &#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">36px</span>;</span><br><span class="line">    <span class="attribute">position</span>: relative;</span><br><span class="line">    <span class="attribute">background-color</span>: <span class="number">#333</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-tag">a</span> &#123;</span><br><span class="line">    <span class="attribute">display</span>: inline-block;</span><br><span class="line">    <span class="attribute">position</span>: absolute;</span><br><span class="line">    <span class="attribute">top</span>: <span class="number">23%</span>;</span><br><span class="line">    <span class="attribute">color</span>: <span class="number">#fff</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.switch</span> &#123;</span><br><span class="line">    <span class="attribute">left</span>: <span class="number">10px</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.expand</span> &#123;</span><br><span class="line">    <span class="attribute">right</span>: <span class="number">10px</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.progress</span> &#123;</span><br><span class="line">    <span class="attribute">position</span>: absolute;</span><br><span class="line">    <span class="attribute">left</span>: <span class="number">40px</span>;</span><br><span class="line">    <span class="attribute">top</span>: <span class="number">30%</span>;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">480px</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">13px</span>;</span><br><span class="line">    <span class="attribute">background-color</span>: <span class="number">#666</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.loaded</span>,</span><br><span class="line"><span class="selector-class">.elapsed</span>,</span><br><span class="line"><span class="selector-class">.bar</span> &#123;</span><br><span class="line">    <span class="attribute">position</span>: absolute;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">100%</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.loaded</span> &#123;</span><br><span class="line">    <span class="attribute">z-index</span>: <span class="number">1</span>;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">60%</span>;</span><br><span class="line">    <span class="attribute">background-color</span>: <span class="number">#ccc</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.elapsed</span> &#123;</span><br><span class="line">    <span class="attribute">z-index</span>: <span class="number">2</span>;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">0%</span>;</span><br><span class="line">    <span class="attribute">background-color</span>: <span class="number">#fff</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.bar</span> &#123;</span><br><span class="line">    <span class="attribute">z-index</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.time</span> &#123;</span><br><span class="line">    <span class="attribute">color</span>: <span class="number">#fff</span>;</span><br><span class="line">    <span class="attribute">position</span>: absolute;</span><br><span class="line">    <span class="attribute">right</span>: <span class="number">46px</span>;</span><br><span class="line">    <span class="attribute">top</span>: <span class="number">24%</span>;</span><br><span class="line">    <span class="attribute">font-size</span>: <span class="number">14px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/04/14/post03/" data-id="cjujtssz500045st38o73vacv" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-post02" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/04/13/post02/" class="article-date">
  <time datetime="2019-04-13T11:22:18.141Z" itemprop="datePublished">2019-04-13</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/04/13/post02/">node.js study day05</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><a href="#body-parser">body-parser —&gt;插件</a></p>
<p><a href="#添加英雄">添加英雄—&gt;案例</a></p>
<p><a href="#1">1.创建文件夹</a></p>
<p><a href="#2">2./api_server文件夹</a></p>
<p><a href="#2.1">2.1 准备工作</a></p>
<p><a href="#2.2">2.2 创建server.js文件完成所有功能</a></p>
<p><a href="#2.3">2.3 按功能封装模块</a></p>
<h2 id="node-js-study-day05"><a href="#node-js-study-day05" class="headerlink" title="node.js study day05"></a>node.js study day05</h2><h3 id="body-parser-—-gt-插件"><a href="#body-parser-—-gt-插件" class="headerlink" title="body-parser —&gt;插件"></a>body-parser —&gt;插件<a name="body-parser"></a></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ npm i body-parser//作用:将post数据转为对象,第三方中间件</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>);</span><br><span class="line"><span class="keyword">const</span> bodyParse = <span class="built_in">require</span>(<span class="string">'body-parser'</span>);</span><br><span class="line"><span class="keyword">const</span> app = express();</span><br><span class="line">app.use(bodyParse.urlencoded(&#123; <span class="attr">extended</span>: <span class="literal">false</span> &#125;));<span class="comment">//固定写法,get请求也触发</span></span><br><span class="line">app.get(<span class="string">'/user'</span>, (req, res) =&gt; &#123;<span class="comment">//直接url拼接参数'/user?uname=jack&amp;pwd=123'</span></span><br><span class="line">    res.send(req.query);<span class="comment">//获取get请求url中拼接参数</span></span><br><span class="line">&#125;)</span><br><span class="line">app.get(<span class="string">'/user/:id/:name'</span>, (req, res) =&gt; &#123;<span class="comment">//'user/1/jack' 利于seo</span></span><br><span class="line">    res.send(req.params);</span><br><span class="line">&#125;)</span><br><span class="line">app.post(<span class="string">'/user'</span>, (req, res) =&gt; &#123;</span><br><span class="line">    res.send(req.body);<span class="comment">//bodyParse中间件直接得到post请求体数据</span></span><br><span class="line">&#125;)</span><br><span class="line">app.listen(<span class="number">3000</span>, () =&gt; <span class="built_in">console</span>.log(<span class="string">'server running at http://127.0.0.1:3000'</span>));</span><br></pre></td></tr></table></figure>
<h4 id="body-parser原理类似于以下中间件函数"><a href="#body-parser原理类似于以下中间件函数" class="headerlink" title="body-parser原理类似于以下中间件函数"></a>body-parser原理类似于以下中间件函数</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> querystring = <span class="built_in">require</span>(<span class="string">'querystring'</span>);<span class="comment">//详见上一天笔记</span></span><br><span class="line">app.use(<span class="function">(<span class="params">req, res, next</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> dataStr = <span class="string">''</span>;</span><br><span class="line">    req.on(<span class="string">'data'</span>, chunk =&gt; &#123;</span><br><span class="line">        dataStr += chunk;</span><br><span class="line">    &#125;)</span><br><span class="line">    req.on(<span class="string">'end'</span>, () =&gt; &#123;</span><br><span class="line">        req.body = querystring.parse(dataStr);</span><br><span class="line">        next();</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h3 id="添加英雄—-gt-案例"><a href="#添加英雄—-gt-案例" class="headerlink" title="添加英雄—&gt;案例"></a>添加英雄—&gt;案例<a name="添加英雄"></a></h3><h4 id="1-创建文件夹"><a href="#1-创建文件夹" class="headerlink" title="1.创建文件夹"></a>1.创建文件夹<a name="1"></a></h4><p>1.1 /api_server(端口:5000)</p>
<p>1.2 /web_server(端口:3000)</p>
<h4 id="2-api-server文件夹"><a href="#2-api-server文件夹" class="headerlink" title="2./api_server文件夹"></a>2./api_server文件夹<a name="2"></a></h4><h5 id="2-1-准备工作"><a href="#2-1-准备工作" class="headerlink" title="2.1 准备工作"></a>2.1 准备工作<a name="2.1"></a></h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ yarn init -y</span><br><span class="line">$ yarn add express</span><br><span class="line">$ yarn add mysql</span><br><span class="line">$ yarn add body-parser</span><br></pre></td></tr></table></figure>
<p>phpstudy启动数据库</p>
<p>Navicat创建数据库expressStudy数据库,创建heros表格,字段:id,name,gender,ctime,isdel(默认0未删除,1已删除)</p>
<h5 id="2-2-创建server-js文件完成所有功能"><a href="#2-2-创建server-js文件完成所有功能" class="headerlink" title="2.2 创建server.js文件完成所有功能"></a>2.2 创建server.js文件完成所有功能<a name="2.2"></a></h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> express=<span class="built_in">require</span>(<span class="string">'express'</span>);</span><br><span class="line"><span class="keyword">const</span> app=express();</span><br><span class="line"><span class="keyword">const</span> mysql=<span class="built_in">require</span>(<span class="string">'mysql'</span>);</span><br><span class="line"><span class="keyword">const</span> conn=mysql.createConnection(&#123;</span><br><span class="line">   host:<span class="string">'127.0.0.1'</span>,</span><br><span class="line">   user:<span class="string">'root'</span>,</span><br><span class="line">   password:<span class="string">'root'</span>,</span><br><span class="line">   database:<span class="string">'expressStudy'</span></span><br><span class="line">&#125;);</span><br><span class="line"><span class="keyword">const</span> bodyParser=<span class="built_in">require</span>(<span class="string">'body-parser'</span>);</span><br><span class="line">app.use(bodyParser.urlencoded(&#123;<span class="attr">expended</span>:<span class="literal">false</span>&#125;));</span><br><span class="line"><span class="comment">//测试服务器正常启动</span></span><br><span class="line">app.get(<span class="string">'/'</span>,(req,res)=&gt;&#123;</span><br><span class="line">    res.send(<span class="string">'ok'</span>);<span class="comment">//express增加send方法,避免中文乱码</span></span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">//查询所有英雄</span></span><br><span class="line">app.get(<span class="string">'/getAllHero'</span>,(req,res)=&gt;&#123;<span class="comment">//路径中注意是否有'/'</span></span><br><span class="line">    <span class="keyword">const</span> sql=<span class="string">'select * from heros'</span>;</span><br><span class="line">    conn.query(sql,(err,result)=&gt;&#123;</span><br><span class="line">        <span class="keyword">if</span>(err) <span class="keyword">return</span> res.send(&#123;<span class="attr">status</span>:<span class="number">500</span>,<span class="attr">msg</span>:err.message,<span class="attr">data</span>:<span class="literal">null</span>&#125;);</span><br><span class="line">        res.send(&#123;<span class="attr">status</span>:<span class="number">200</span>,<span class="attr">data</span>:result&#125;);</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">//添加英雄</span></span><br><span class="line">app.post(<span class="string">'/addHero'</span>,(req,res)=&gt;&#123;</span><br><span class="line">    <span class="keyword">const</span> hero=req.body;</span><br><span class="line">    <span class="keyword">const</span> dt=<span class="keyword">new</span> <span class="built_in">Date</span>();</span><br><span class="line">    <span class="keyword">let</span> y=dt.getFullYear();</span><br><span class="line">    <span class="keyword">let</span> m=dt.getMonth().toString().padStart(<span class="number">2</span>,<span class="string">'0'</span>);</span><br><span class="line">    <span class="keyword">let</span> d=dt.getDate().toString().padStart(<span class="number">2</span>,<span class="string">'0'</span>);</span><br><span class="line">    <span class="keyword">let</span> hh=dt.getHours().toString().padStart(<span class="number">2</span>,<span class="string">'0'</span>);</span><br><span class="line">    <span class="keyword">let</span> mm=dt.getMunites().toString().padStart(<span class="number">2</span>,<span class="string">'0'</span>);</span><br><span class="line">    <span class="keyword">let</span> ss=dt.getSeconds().toString().padStart(<span class="number">2</span>,<span class="string">'0'</span>);</span><br><span class="line">    hero.ctime=y+<span class="string">'-'</span>+m+<span class="string">'-'</span>+d+<span class="string">' '</span>+hh+<span class="string">':'</span>+mm+<span class="string">':'</span>+ss;</span><br><span class="line">    <span class="keyword">const</span> sql=<span class="string">'insert into heros set ?'</span>;</span><br><span class="line">    conn.query(sql,(err,result)=&gt;&#123;</span><br><span class="line">        <span class="keyword">if</span>(err) <span class="keyword">return</span> res.send(&#123;<span class="attr">status</span>:<span class="number">500</span>,<span class="attr">msg</span>:err.message,<span class="attr">data</span>:<span class="literal">null</span>&#125;);</span><br><span class="line">        res.send(&#123;<span class="attr">status</span>:<span class="number">200</span>,<span class="attr">data</span>:<span class="literal">null</span>&#125;);</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">//修改英雄信息</span></span><br><span class="line">app.post(<span class="string">'/updateHero/:id'</span>,(req,res)=&gt;&#123;</span><br><span class="line">    <span class="keyword">const</span> id=req.params;</span><br><span class="line">    <span class="keyword">const</span> sql=<span class="string">'update heros set ? where id=?'</span>;</span><br><span class="line">    conn.query(sql,[req.body,id],(err,result)=&gt;&#123;</span><br><span class="line">        <span class="keyword">if</span>(err) <span class="keyword">return</span> res.send(&#123;<span class="attr">status</span>:<span class="number">500</span>,<span class="attr">msg</span>:err.message,<span class="attr">data</span>:<span class="literal">null</span>&#125;);</span><br><span class="line">        res.send(&#123;<span class="attr">status</span>:<span class="number">200</span>,<span class="attr">data</span>:<span class="literal">null</span>&#125;);</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">//英雄软删除</span></span><br><span class="line">app.get(<span class="string">'/delHero/:id'</span>,(req,res)=&gt;&#123;</span><br><span class="line">    <span class="keyword">const</span> id=req.params;</span><br><span class="line">    <span class="keyword">const</span> sql=<span class="string">'update heros set isdel=1 where id=?'</span>;</span><br><span class="line">    conn.query(sql,id,(err,result)=&gt;&#123;</span><br><span class="line">        <span class="keyword">if</span>(err) <span class="keyword">return</span> res.send(&#123;<span class="attr">status</span>:<span class="number">500</span>,<span class="attr">msg</span>:err.message,<span class="attr">data</span>:<span class="literal">null</span>&#125;);</span><br><span class="line">        res.send(&#123;<span class="attr">status</span>:<span class="number">200</span>,<span class="attr">data</span>:<span class="literal">null</span>&#125;);</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br><span class="line">app.listen(<span class="number">5000</span>,()=&gt;<span class="built_in">console</span>.log(<span class="string">'server running at http://127.0.0.1:5000'</span>))</span><br></pre></td></tr></table></figure>
<h5 id="2-3-按功能封装模块"><a href="#2-3-按功能封装模块" class="headerlink" title="2.3 按功能封装模块"></a>2.3 按功能封装模块<a name="2.3"></a></h5><p>2.3.1 server.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>);</span><br><span class="line"><span class="keyword">const</span> app = express();</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> bodyParser = <span class="built_in">require</span>(<span class="string">'body-parser'</span>);</span><br><span class="line">app.use(bodyParser.urlencoded(&#123; <span class="attr">extended</span>: <span class="literal">false</span> &#125;));</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> router = <span class="built_in">require</span>(<span class="string">'./router.js'</span>);</span><br><span class="line">app.use(router);</span><br><span class="line"></span><br><span class="line">app.listen(<span class="number">5000</span>, () =&gt; <span class="built_in">console</span>.log(<span class="string">'api_server running at http://127.0.0.1:5000'</span>))</span><br></pre></td></tr></table></figure>
<p>2.3.2 router.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>);</span><br><span class="line"><span class="keyword">const</span> router = express.Router();</span><br><span class="line"><span class="keyword">const</span> ctrl = <span class="built_in">require</span>(<span class="string">'./controller.js'</span>);</span><br><span class="line">router.get(<span class="string">'/'</span>, ctrl.test)</span><br><span class="line">router.get(<span class="string">'/getAllHero'</span>, ctrl.getAllHero)</span><br><span class="line">router.post(<span class="string">'/addHero'</span>, ctrl.addHero)</span><br><span class="line">router.get(<span class="string">'/getHero/:id'</span>, ctrl.getHero)</span><br><span class="line">router.post(<span class="string">'/updateHero/:id'</span>, ctrl.updateHero)</span><br><span class="line">router.get(<span class="string">'/delHero/:id'</span>, ctrl.delHero)</span><br><span class="line"><span class="built_in">module</span>.exports = router;</span><br></pre></td></tr></table></figure>
<p>2.3.3 controller.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> conn=<span class="built_in">require</span>(<span class="string">'./db.js'</span>);</span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    test:<span class="function">(<span class="params">req,res</span>)=&gt;</span>&#123;</span><br><span class="line">        res.send(<span class="string">'ok'</span>);</span><br><span class="line">    &#125;,</span><br><span class="line">    getAllHero: <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> sql = <span class="string">'select * from heros'</span>;</span><br><span class="line">        conn.query(sql, (err, result) =&gt; &#123;</span><br><span class="line">            <span class="keyword">if</span> (err) <span class="keyword">return</span> res.send(&#123; <span class="attr">status</span>: <span class="number">500</span>, <span class="attr">msg</span>: err.message, <span class="attr">data</span>: <span class="literal">null</span> &#125;);</span><br><span class="line">            res.send(&#123; <span class="attr">status</span>: <span class="number">200</span>, <span class="attr">data</span>: result &#125;);</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    addHero:<span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">        hero = req.body;</span><br><span class="line">        <span class="keyword">let</span> dt = <span class="keyword">new</span> <span class="built_in">Date</span>();</span><br><span class="line">        <span class="keyword">let</span> y = dt.getFullYear();</span><br><span class="line">        <span class="keyword">let</span> m = dt.getMonth().toString().padStart(<span class="number">2</span>, <span class="string">'0'</span>);</span><br><span class="line">        <span class="keyword">let</span> d = dt.getDate().toString().padStart(<span class="number">2</span>, <span class="string">'0'</span>);</span><br><span class="line">        <span class="keyword">let</span> hh = dt.getHours().toString().padStart(<span class="number">2</span>, <span class="string">'0'</span>);</span><br><span class="line">        <span class="keyword">let</span> mm = dt.getMinutes().toString().padStart(<span class="number">2</span>, <span class="string">'0'</span>);</span><br><span class="line">        <span class="keyword">let</span> ss = dt.getSeconds().toString().padStart(<span class="number">2</span>, <span class="string">'0'</span>);</span><br><span class="line">        hero.ctime = y + <span class="string">'-'</span> + m + <span class="string">'-'</span> + d + <span class="string">' '</span> + hh + <span class="string">':'</span> + mm + <span class="string">':'</span> + ss;</span><br><span class="line">        <span class="keyword">let</span> sql = <span class="string">'insert into heros set ?'</span>;</span><br><span class="line">        conn.query(sql, hero, (err, result) =&gt; &#123;</span><br><span class="line">            <span class="keyword">if</span> (err) <span class="keyword">return</span> res.send(&#123; <span class="attr">status</span>: <span class="number">500</span>, <span class="attr">msg</span>: err.message, <span class="attr">data</span>: <span class="literal">null</span> &#125;);</span><br><span class="line">            res.send(&#123; <span class="attr">status</span>: <span class="number">200</span>, <span class="attr">data</span>: <span class="literal">null</span> &#125;);</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    getHero:<span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> id = req.params.id;</span><br><span class="line">        <span class="keyword">let</span> sql = <span class="string">'select * from heros where id=?'</span>;</span><br><span class="line">        conn.query(sql, id, (err, result) =&gt; &#123;</span><br><span class="line">            <span class="keyword">if</span> (err) <span class="keyword">return</span> res.send(&#123; <span class="attr">status</span>: <span class="number">500</span>, <span class="attr">msg</span>: err.message, <span class="attr">data</span>: <span class="literal">null</span> &#125;);</span><br><span class="line">            res.send(&#123; <span class="attr">status</span>: <span class="number">200</span>, <span class="attr">data</span>: result &#125;);</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    updateHero:<span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> id = req.params.id;</span><br><span class="line">        <span class="keyword">let</span> sql = <span class="string">'update heros set ? where id=?'</span>;</span><br><span class="line">        conn.query(sql, [req.body, id], (err, result) =&gt; &#123;</span><br><span class="line">            <span class="keyword">if</span> (err) <span class="keyword">return</span> res.send(&#123; <span class="attr">status</span>: <span class="number">500</span>, <span class="attr">msg</span>: err.message, <span class="attr">data</span>: <span class="literal">null</span> &#125;);</span><br><span class="line">            res.send(&#123; <span class="attr">status</span>: <span class="number">200</span>, <span class="attr">data</span>: <span class="literal">null</span> &#125;);</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    delHero:<span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> id = req.params.id;</span><br><span class="line">        <span class="keyword">let</span> sql = <span class="string">'update heros set isdel=1 where id=?'</span>;</span><br><span class="line">        conn.query(sql, id, (err, result) =&gt; &#123;</span><br><span class="line">            <span class="keyword">if</span> (err) <span class="keyword">return</span> res.send(&#123; <span class="attr">status</span>: <span class="number">500</span>, <span class="attr">msg</span>: err.message, <span class="attr">data</span>: <span class="literal">null</span> &#125;);</span><br><span class="line">            res.send(&#123; <span class="attr">status</span>: <span class="number">200</span>, <span class="attr">data</span>: <span class="literal">null</span> &#125;);</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>2.3.3 db.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> mysql = <span class="built_in">require</span>(<span class="string">'mysql'</span>);</span><br><span class="line"><span class="keyword">const</span> conn = mysql.createConnection(&#123;</span><br><span class="line">    host: <span class="string">'127.0.0.1'</span>,</span><br><span class="line">    user: <span class="string">'root'</span>,</span><br><span class="line">    password: <span class="string">'root'</span>,</span><br><span class="line">    database: <span class="string">'expressStudy'</span></span><br><span class="line">&#125;);</span><br><span class="line"><span class="built_in">module</span>.exports=conn;</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/04/13/post02/" data-id="cjujtssza00055st3xu1r6ihl" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-post01" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/04/11/post01/" class="article-date">
  <time datetime="2019-04-11T12:32:22.274Z" itemprop="datePublished">2019-04-11</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/04/11/post01/">node.js study day04</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><a href="#nodemon">nodemon —&gt;插件</a></p>
<p><a href="#express"><em>express</em>—&gt;框架</a></p>
<p><a href="#ejs">ejs—&gt;模板</a></p>
<p><a href="#art">art-template—&gt;模板</a></p>
<p><a href="#router"><em>router</em>(路由)—&gt;前台请求分流</a></p>
<p><a href="#Middleware"><em>Middleware</em>(中间件)—&gt;重点</a></p>
<p><a href="#mysql">mysql—&gt;与php数据库对比记忆</a></p>
<h2 id="node-js-study-day04"><a href="#node-js-study-day04" class="headerlink" title="node.js study day04"></a>node.js study day04</h2><h3 id="nodemon-—-gt-插件"><a href="#nodemon-—-gt-插件" class="headerlink" title="nodemon —&gt;插件"></a>nodemon —&gt;插件<a name="nodemon"></a></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ npm i nodemon -g</span><br><span class="line">$ nodemon 文件名</span><br></pre></td></tr></table></figure>
<p>编辑保存后自动重启服务器</p>
<h3 id="express—-gt-框架"><a href="#express—-gt-框架" class="headerlink" title="express—&gt;框架"></a><em>express</em>—&gt;框架<a name="express"></a></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ npm i express</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//通过express框架快速开启服务器</span></span><br><span class="line"><span class="keyword">const</span> express=<span class="built_in">require</span>(<span class="string">'express'</span>);</span><br><span class="line"><span class="keyword">const</span> app=express();</span><br><span class="line"><span class="comment">//writing your code</span></span><br><span class="line"><span class="comment">//app.use()方法挂载中间件函数 express.static('静态文件目录')方法托管目录中静态文件</span></span><br><span class="line">app.use(express.static(<span class="string">'./assets'</span>));</span><br><span class="line">app.listen(<span class="number">3000</span>,()=&gt;<span class="built_in">console</span>.log(<span class="string">'server running on http://127.0.0.1:3000'</span>))</span><br></pre></td></tr></table></figure>
<h3 id="ejs—-gt-模板"><a href="#ejs—-gt-模板" class="headerlink" title="ejs—&gt;模板"></a>ejs—&gt;模板<a name="ejs"></a></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ npm i ejs</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> express=<span class="built_in">require</span>(<span class="string">'express'</span>);</span><br><span class="line"><span class="keyword">const</span> app=express();</span><br><span class="line">app.set(<span class="string">'view engine'</span>,<span class="string">'ejs'</span>);<span class="comment">//引入ejs模板的固定写法</span></span><br><span class="line">app.set(<span class="string">'views'</span>,<span class="string">'./ejs_views'</span>);<span class="comment">//第一个参数是固定写法,第二个参数给出.ejs文件的路径</span></span><br><span class="line">app.get(<span class="string">'/'</span>,(req,res)=&gt;&#123;</span><br><span class="line">    res.render(<span class="string">'index.ejs'</span>,&#123;<span class="attr">name</span>:<span class="string">'jack'</span>,<span class="attr">age</span>:<span class="number">18</span>,<span class="attr">hobby</span>:[<span class="string">'eat'</span>,<span class="string">'dance'</span>]&#125;);</span><br><span class="line">&#125;)</span><br><span class="line">app.listen(<span class="number">3000</span>,()=&gt;<span class="built_in">console</span>.log(<span class="string">'server running at http://127.0.0.1:3000'</span>))</span><br></pre></td></tr></table></figure>
<h3 id="art-template—-gt-模板"><a href="#art-template—-gt-模板" class="headerlink" title="art-template—&gt;模板"></a>art-template—&gt;模板<a name="art"></a></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ npm i art-template</span><br><span class="line">$ npm i express-art-template</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//①②③一致</span></span><br><span class="line"><span class="keyword">const</span> express=<span class="built_in">require</span>(<span class="string">'express'</span>);</span><br><span class="line"><span class="keyword">const</span> app=express();</span><br><span class="line">app.engine(<span class="string">'html'</span>,<span class="built_in">require</span>(<span class="string">'express-art-template'</span>));<span class="comment">//第一个参数①</span></span><br><span class="line">app.set(<span class="string">'view engine'</span>,<span class="string">'html'</span>);<span class="comment">//第二个参数②</span></span><br><span class="line">app.set(<span class="string">'views'</span>,<span class="string">'art_views'</span>);</span><br><span class="line">app.get(<span class="string">'/'</span>,(req,res)=&gt;&#123;</span><br><span class="line">    res.render(<span class="string">'index.html'</span>,&#123;<span class="attr">name</span>:<span class="string">'jack'</span>,<span class="attr">age</span>:<span class="number">18</span>,<span class="attr">hobby</span>:[<span class="string">'eat'</span>,<span class="string">'dance'</span>]&#125;);<span class="comment">//第一个参数扩展名③</span></span><br><span class="line">&#125;)</span><br><span class="line">app.listen(<span class="number">3000</span>,()=&gt;<span class="built_in">console</span>.log(<span class="string">'server running at http://127.0.0.1:3000'</span>))</span><br></pre></td></tr></table></figure>
<h3 id="router-路由-—-gt-前台请求分流"><a href="#router-路由-—-gt-前台请求分流" class="headerlink" title="router(路由)—&gt;前台请求分流"></a><em>router</em>(路由)—&gt;前台请求分流<a name="router"></a></h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//router.js文件处理请求及回调函数</span></span><br><span class="line"><span class="keyword">const</span> express=<span class="built_in">require</span>(<span class="string">'express'</span>);</span><br><span class="line"><span class="keyword">const</span> router=experss.Router();<span class="comment">//固定写法</span></span><br><span class="line">router.get(<span class="string">'/'</span>,(req,res)=&gt;&#123;</span><br><span class="line">    res.sendFile(<span class="string">'./views/index.html'</span>,&#123;<span class="attr">root</span>:__dirname&#125;);</span><br><span class="line">&#125;)</span><br><span class="line"><span class="built_in">module</span>.exports=router;</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//可调用router.js文件处理请求</span></span><br><span class="line"><span class="keyword">const</span> express=<span class="built_in">require</span>(<span class="string">'express'</span>);</span><br><span class="line"><span class="keyword">const</span> app=express();</span><br><span class="line"><span class="keyword">const</span> router=<span class="built_in">require</span>(<span class="string">'./router.js'</span>);<span class="comment">//router.js文件路径</span></span><br><span class="line">app.use(router);</span><br><span class="line">app.listen(<span class="number">3000</span>,()=&gt;<span class="built_in">console</span>.log(<span class="string">'server running at http://127.0.0.1:3000'</span>));</span><br></pre></td></tr></table></figure>
<h3 id="Middleware-中间件-—-gt-重点"><a href="#Middleware-中间件-—-gt-重点" class="headerlink" title="Middleware(中间件)—&gt;重点"></a><em>Middleware</em>(中间件)—&gt;重点<a name="Middleware"></a></h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> express=<span class="built_in">require</span>(<span class="string">'express'</span>);</span><br><span class="line"><span class="keyword">const</span> app=express();</span><br><span class="line"><span class="keyword">const</span> querystring=<span class="built_in">require</span>(<span class="string">'querystring'</span>);<span class="comment">//node.js处理查询字符串的核心模块</span></span><br><span class="line">app.use(<span class="function">(<span class="params">req,res,next</span>)=&gt;</span>&#123;<span class="comment">//自定义中间件函数通过app.use()方法挂载,处理post请求体数据</span></span><br><span class="line">    <span class="keyword">let</span> dataStr=<span class="string">''</span>;</span><br><span class="line">    req.on(<span class="string">'data'</span>,chunk=&gt;&#123;<span class="comment">//req的data事件在获取完整数据前持续触发</span></span><br><span class="line">        dataStr+=chunk;</span><br><span class="line">    &#125;)</span><br><span class="line">    req.on(<span class="string">'end'</span>,()=&gt;&#123;<span class="comment">//req的end事件在获取完数据后触发</span></span><br><span class="line">        req.body=querystring.parse(dataStr);<span class="comment">//将获取的k=v&amp;k1=v1字符串转为对象,存入请求体</span></span><br><span class="line">        next();<span class="comment">//中间件函数执行完进入下一段</span></span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br><span class="line">app.get(<span class="string">'/'</span>,(req,res)=&gt;&#123;</span><br><span class="line">    res.sendFile(<span class="string">'index.html'</span>, &#123; <span class="attr">root</span>: __dirname &#125;);<span class="comment">//get请求也会执行中间体函数</span></span><br><span class="line">&#125;)</span><br><span class="line">app.post(<span class="string">'/data'</span>, (req, res) =&gt; &#123;</span><br><span class="line">    res.send(req.body);</span><br><span class="line">&#125;)</span><br><span class="line">app.listen(<span class="number">3000</span>, () =&gt; &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'server running at http://127.0.0.1:3000'</span>);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h3 id="mysql—-gt-与php数据库对比记忆"><a href="#mysql—-gt-与php数据库对比记忆" class="headerlink" title="mysql—&gt;与php数据库对比记忆"></a>mysql—&gt;与php数据库对比记忆<a name="mysql"></a></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">const express = require(<span class="string">'express'</span>);</span><br><span class="line">const app = express();</span><br><span class="line">const mysql = require(<span class="string">'mysql'</span>);</span><br><span class="line">const conn = mysql.createConnection(&#123;</span><br><span class="line">    host: <span class="string">'127.0.0.1'</span>,</span><br><span class="line">    user: <span class="string">'root'</span>,</span><br><span class="line">    password: <span class="string">'root'</span>,</span><br><span class="line">    database: <span class="string">'jd'</span></span><br><span class="line">&#125;);</span><br><span class="line">// const sqlStr=<span class="string">'select * from info'</span>;</span><br><span class="line">//-----------新增----------</span><br><span class="line">// const infoData = &#123; src: <span class="string">'11'</span>, text: <span class="string">'222'</span> &#125;;</span><br><span class="line">// const sqlStr = <span class="string">'insert into info set ?'</span>;</span><br><span class="line">// conn.query(sqlStr, infoData, (err, result) =&gt; &#123;</span><br><span class="line">//     <span class="keyword">if</span> (err) <span class="built_in">return</span> console.log(err.message);</span><br><span class="line">//     console.log(result);</span><br><span class="line">// &#125;)</span><br><span class="line">//-----------修改----------</span><br><span class="line">// const infoData = &#123; id: 4, src: <span class="string">'555'</span>, text: <span class="string">'666'</span> &#125;;</span><br><span class="line">// const sqlStr = <span class="string">'update info set ? where id=?'</span>;</span><br><span class="line">// conn.query(sqlStr, [infoData, infoData.id], (err, result) =&gt; &#123;</span><br><span class="line">//     <span class="keyword">if</span> (err) <span class="built_in">return</span> console.log(err.message);</span><br><span class="line">//     console.log(result);</span><br><span class="line">// &#125;)</span><br><span class="line">//-----------删除----------</span><br><span class="line">const infoData = &#123; id: 4 &#125;;</span><br><span class="line">const sqlStr = <span class="string">'delete from info where id=?'</span>;</span><br><span class="line">conn.query(sqlStr, infoData.id, (err, result) =&gt; &#123;</span><br><span class="line">    <span class="keyword">if</span> (err) <span class="built_in">return</span> console.log(err.message);</span><br><span class="line">    console.log(result);</span><br><span class="line">&#125;)</span><br><span class="line">app.listen(3000, () =&gt; console.log(<span class="string">'server running at http://127.0.0.1:3000'</span>));</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/04/11/post01/" data-id="cjujtssw800015st36jhk4ddz" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  


</section>
        
          <aside id="sidebar">
  
    

  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/04/">四月 2019</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2019/04/16/post06 cookie和session/">(no title)</a>
          </li>
        
          <li>
            <a href="/2019/04/16/post05/">node.js study day07 博客案例整理</a>
          </li>
        
          <li>
            <a href="/2019/04/15/post04/">node.js review day02 布局</a>
          </li>
        
          <li>
            <a href="/2019/04/14/post03/">node.js study day06 &amp; 全屏和视频播放复习</a>
          </li>
        
          <li>
            <a href="/2019/04/13/post02/">node.js study day05</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2019 Yin Cai<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>



  </div>
</body>
</html>